<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>WEM.postWRF.postWRF.main &mdash; WEM 0.9.0 documentation</title>
    
    <link rel="stylesheet" href="../../../../_static/alabaster.css" type="text/css" />
    <link rel="stylesheet" href="../../../../_static/pygments.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    '../../../../',
        VERSION:     '0.9.0',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="../../../../_static/jquery.js"></script>
    <script type="text/javascript" src="../../../../_static/underscore.js"></script>
    <script type="text/javascript" src="../../../../_static/doctools.js"></script>
    <link rel="top" title="WEM 0.9.0 documentation" href="../../../../index.html" />
    <link rel="up" title="Module code" href="../../../index.html" />
   
  
  <meta name="viewport" content="width=device-width, initial-scale=0.9, maximum-scale=0.9">

  </head>
  <body>
    <div class="related">
      <h3>Navigation</h3>
      <ul>
        <li class="right" style="margin-right: 10px">
          <a href="../../../../genindex.html" title="General Index"
             accesskey="I">index</a></li>
        <li class="right" >
          <a href="../../../../py-modindex.html" title="Python Module Index"
             >modules</a> |</li>
        <li><a href="../../../../index.html">WEM 0.9.0 documentation</a> &raquo;</li>
          <li><a href="../../../index.html" accesskey="U">Module code</a> &raquo;</li> 
      </ul>
    </div>  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          <div class="body">
            
  <h1>Source code for WEM.postWRF.postWRF.main</h1><div class="highlight"><pre>
<span class="sd">&quot;&quot;&quot; This handles user requests and controls computations and plotting.</span>

<span class="sd">This script is API and should not be doing any hard work of</span>
<span class="sd">importing matplotlib etc!</span>

<span class="sd">Useful/utility scripts are in WEM.utils.</span>

<span class="sd">TODO: move all DKE stuff to stats and figure/birdseye.</span>
<span class="sd">TODO: move more utilities to utils.</span>
<span class="sd">&quot;&quot;&quot;</span>
<span class="kn">from</span> <span class="nn">netCDF4</span> <span class="kn">import</span> <span class="n">Dataset</span>
<span class="kn">import</span> <span class="nn">calendar</span>
<span class="kn">import</span> <span class="nn">collections</span>
<span class="kn">import</span> <span class="nn">copy</span>
<span class="kn">import</span> <span class="nn">cPickle</span> <span class="kn">as</span> <span class="nn">pickle</span>
<span class="kn">import</span> <span class="nn">fnmatch</span>
<span class="kn">import</span> <span class="nn">glob</span>
<span class="kn">import</span> <span class="nn">itertools</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="kn">as</span> <span class="nn">N</span>
<span class="kn">import</span> <span class="nn">os</span>
<span class="kn">import</span> <span class="nn">pdb</span>
<span class="kn">import</span> <span class="nn">time</span>
<span class="kn">import</span> <span class="nn">matplotlib</span> <span class="kn">as</span> <span class="nn">M</span>
<span class="n">M</span><span class="o">.</span><span class="n">use</span><span class="p">(</span><span class="s">&#39;gtkagg&#39;</span><span class="p">)</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="kn">as</span> <span class="nn">plt</span>

<span class="kn">from</span> <span class="nn">wrfout</span> <span class="kn">import</span> <span class="n">WRFOut</span>
<span class="kn">from</span> <span class="nn">figure</span> <span class="kn">import</span> <span class="n">Figure</span>
<span class="kn">from</span> <span class="nn">birdseye</span> <span class="kn">import</span> <span class="n">BirdsEye</span>
<span class="kn">from</span> <span class="nn">ruc</span> <span class="kn">import</span> <span class="n">RUC</span>
<span class="kn">from</span> <span class="nn">skewt</span> <span class="kn">import</span> <span class="n">SkewT</span>
<span class="kn">from</span> <span class="nn">skewt</span> <span class="kn">import</span> <span class="n">Profile</span>
<span class="c">#import scales</span>
<span class="kn">from</span> <span class="nn">defaults</span> <span class="kn">import</span> <span class="n">Defaults</span>
<span class="kn">import</span> <span class="nn">WEM.utils</span> <span class="kn">as</span> <span class="nn">utils</span>
<span class="kn">from</span> <span class="nn">xsection</span> <span class="kn">import</span> <span class="n">CrossSection</span>
<span class="kn">from</span> <span class="nn">clicker</span> <span class="kn">import</span> <span class="n">Clicker</span>
<span class="kn">import</span> <span class="nn">maps</span>
<span class="kn">import</span> <span class="nn">stats</span>
<span class="kn">from</span> <span class="nn">scales</span> <span class="kn">import</span> <span class="n">Scales</span>

<span class="c"># TODO: Make this awesome</span>

<div class="viewcode-block" id="WRFEnviron"><a class="viewcode-back" href="../../../../WEM.postWRF.postWRF.html#WEM.postWRF.postWRF.main.WRFEnviron">[docs]</a><span class="k">class</span> <span class="nc">WRFEnviron</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Main environment API.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; This currently only loads default settings.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c"># Set defaults</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">D</span> <span class="o">=</span> <span class="n">Defaults</span><span class="p">()</span>

        <span class="c">#self.font_prop = getattr(self.C,&#39;font_prop&#39;,self.D.font_prop)</span>
        <span class="c">#self.usetex = getattr(self.C,&#39;usetex&#39;,self.D.usetex)</span>
        <span class="c">#self.plot_titles = getattr(self.C,&#39;plot_titles&#39;,self.D.plot_titles)</span>
        <span class="c">#M.rc(&#39;text&#39;,usetex=self.usetex)</span>
        <span class="c">#M.rc(&#39;font&#39;,**self.font_prop)</span>
        <span class="c">#M.rcParams[&#39;savefig.dpi&#39;] = self.dpi</span>

<div class="viewcode-block" id="WRFEnviron.plot2D"><a class="viewcode-back" href="../../../../WEM.postWRF.postWRF.html#WEM.postWRF.postWRF.main.WRFEnviron.plot2D">[docs]</a>    <span class="k">def</span> <span class="nf">plot2D</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">vrbl</span><span class="p">,</span><span class="n">utc</span><span class="p">,</span><span class="n">level</span><span class="p">,</span><span class="n">ncdir</span><span class="p">,</span><span class="n">outdir</span><span class="p">,</span><span class="n">ncf</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span><span class="n">nct</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span>
                <span class="n">f_prefix</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span><span class="n">f_suffix</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span><span class="n">bounding</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span><span class="n">dom</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
                <span class="n">plottype</span><span class="o">=</span><span class="s">&#39;contourf&#39;</span><span class="p">,</span><span class="n">smooth</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="n">fig</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span><span class="n">ax</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span>
                <span class="n">clvs</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span><span class="n">cmap</span><span class="o">=</span><span class="bp">False</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Basic birds-eye-view plotting.</span>

<span class="sd">        This script is top-most and decides if the variables is</span>
<span class="sd">        built into WRF default output or needs computing. It unstaggers</span>
<span class="sd">        and slices data from the wrfout file appropriately.</span>

<span class="sd">        :param vrbl:        variable name as found in WRF, or one of</span>
<span class="sd">                            the computed fields available in WEM</span>
<span class="sd">        :type vrbl:         str</span>
<span class="sd">        :param utc:         one date/time. The tuple/list format is</span>
<span class="sd">                            YYYY,MM,DD,HH,MM,SS (ready for calendar.timegm).</span>
<span class="sd">                            Integer format is epoch/datenum (ready for</span>
<span class="sd">                            time.gmtime).</span>
<span class="sd">        :type utc:          tuple,list,int</span>
<span class="sd">        :param level:       required level. Lowest model level is integer 2000.</span>
<span class="sd">                            Pressure level is integer in hPa, e.g. 850.</span>
<span class="sd">                            Isentropic surface is a string + K, e.g. &#39;320K&#39;.</span>
<span class="sd">                            Geometric height is a string + m, e.g. &#39;4000m&#39;.</span>
<span class="sd">        :type level:        int,str</span>
<span class="sd">        :param ncdir:       directory of netcdf data file</span>
<span class="sd">        :type ncdir:        str</span>
<span class="sd">        :outdir:            directory to save output figures</span>
<span class="sd">        :type outdir:       str</span>
<span class="sd">        :param ncf:         filename of netcdf data file if ambiguous within ncdir.</span>
<span class="sd">                            If no wrfout file is explicitly specified, the</span>
<span class="sd">                            netCDF file in that folder is chosen if unambiguous.</span>
<span class="sd">        :type ncf:          bool,str</span>
<span class="sd">        :param nct:         initialisation time of netcdf data file, if</span>
<span class="sd">                            ambiguous within ncdir.</span>
<span class="sd">        :type nct:          bool,str</span>
<span class="sd">        :param f_prefix:    custom filename prefix for output. Ignore if False.</span>
<span class="sd">        :type f_prefix:     bool,str</span>
<span class="sd">        :param f_suffix     custom filename suffix for output. Ignore if False.</span>
<span class="sd">        :type f_suffix      bool,str</span>
<span class="sd">        :param bounding:    bounding box for domain.</span>
<span class="sd">                            Dictionary contains four keys (Nlim, Elim, Slim, Wlim)</span>
<span class="sd">                            with float values (northern latitude limit, eastern</span>
<span class="sd">                            longitude limit, southern latitude limit, western</span>
<span class="sd">                            latitude limit, respectively).</span>
<span class="sd">        :type bounding:     dict</span>
<span class="sd">        :param smooth:      pass data through a Gaussian filter. Value of 1 is</span>
<span class="sd">                            essentially `off&#39;.</span>
<span class="sd">                            Integer greater than zero is the degree of smoothing,</span>
<span class="sd">                            in grid spacing.</span>
<span class="sd">        :type smooth:       int</span>
<span class="sd">        :param dom:         domain for plotting (for WRF data).</span>
<span class="sd">                            If zero, the only netCDF file present will be</span>
<span class="sd">                            plotted.</span>
<span class="sd">        :type dom:          int</span>
<span class="sd">        :params plottype:   matplotlib command for plotting data</span>
<span class="sd">                            (contour or contourf).</span>
<span class="sd">        :type plottype:     str</span>
<span class="sd">        :param fig:         value of False will create new figure. A value of</span>
<span class="sd">                            matplotlib.figure object will plot data onto</span>
<span class="sd">                            this figure (similarly for axis, below).</span>
<span class="sd">        :type fig:          bool,matplotlib.figure</span>
<span class="sd">        :param ax:          matplotlib.axis object to plot onto</span>
<span class="sd">        :type ax:           bool,matplotlib.axis</span>

<span class="sd">        :returns:           None.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c"># TODO: lats/lons False when no bounding, and selected with limited</span>
        <span class="c"># domain.</span>

        <span class="n">level</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_level_string</span><span class="p">(</span><span class="n">level</span><span class="p">)</span>

        <span class="c"># Data</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">W</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_netcdf</span><span class="p">(</span><span class="n">ncdir</span><span class="p">,</span><span class="n">ncf</span><span class="o">=</span><span class="n">ncf</span><span class="p">,</span><span class="n">nct</span><span class="o">=</span><span class="n">nct</span><span class="p">,</span><span class="n">dom</span><span class="o">=</span><span class="n">dom</span><span class="p">)</span>
        <span class="c"># lats, lons = self.W.get_limited_domain(bounding)</span>
        <span class="n">data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">W</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">vrbl</span><span class="p">,</span><span class="n">utc</span><span class="p">,</span><span class="n">level</span><span class="p">,</span><span class="n">lons</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span><span class="n">lats</span><span class="o">=</span><span class="bp">False</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">smooth</span><span class="o">&gt;</span><span class="mi">1</span><span class="p">:</span>
            <span class="n">data</span> <span class="o">=</span> <span class="n">stats</span><span class="o">.</span><span class="n">gauss_smooth</span><span class="p">(</span><span class="n">data</span><span class="p">,</span><span class="n">smooth</span><span class="p">)</span>

        <span class="c"># Scales</span>
        <span class="k">if</span> <span class="n">clvs</span> <span class="ow">is</span> <span class="bp">False</span> <span class="ow">and</span> <span class="n">cmap</span> <span class="ow">is</span> <span class="bp">False</span><span class="p">:</span>
            <span class="n">S</span> <span class="o">=</span> <span class="n">Scales</span><span class="p">(</span><span class="n">vrbl</span><span class="p">,</span><span class="n">level</span><span class="p">)</span>
            <span class="n">clvs</span> <span class="o">=</span> <span class="n">S</span><span class="o">.</span><span class="n">clvs</span>
            <span class="n">cmap</span> <span class="o">=</span> <span class="n">S</span><span class="o">.</span><span class="n">cm</span>
        <span class="k">elif</span> <span class="n">clvs</span> <span class="ow">is</span> <span class="bp">False</span><span class="p">:</span>
            <span class="n">S</span> <span class="o">=</span> <span class="n">Scales</span><span class="p">(</span><span class="n">vrbl</span><span class="p">,</span><span class="n">level</span><span class="p">)</span>
            <span class="n">clvs</span> <span class="o">=</span> <span class="n">S</span><span class="o">.</span><span class="n">clvs</span>
        <span class="k">elif</span> <span class="n">cmap</span> <span class="ow">is</span> <span class="bp">False</span><span class="p">:</span>
            <span class="n">S</span> <span class="o">=</span> <span class="n">Scales</span><span class="p">(</span><span class="n">vrbl</span><span class="p">,</span><span class="n">level</span><span class="p">)</span>
            <span class="n">cmap</span> <span class="o">=</span> <span class="n">S</span><span class="o">.</span><span class="n">cm</span>

        <span class="c"># Figure</span>
        <span class="n">fname</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">create_fname</span><span class="p">(</span><span class="n">vrbl</span><span class="p">,</span><span class="n">utc</span><span class="p">,</span><span class="n">level</span><span class="p">)</span>
        <span class="n">F</span> <span class="o">=</span> <span class="n">BirdsEye</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">W</span><span class="p">,</span><span class="n">fig</span><span class="o">=</span><span class="n">fig</span><span class="p">,</span><span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">)</span>
        <span class="c"># import pdb; pdb.set_trace()</span>
        <span class="n">F</span><span class="o">.</span><span class="n">plot2D</span><span class="p">(</span><span class="n">data</span><span class="p">,</span><span class="n">fname</span><span class="p">,</span><span class="n">outdir</span><span class="p">,</span><span class="n">lats</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span><span class="n">lons</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span>
                    <span class="n">plottype</span><span class="o">=</span><span class="n">plottype</span><span class="p">,</span><span class="n">smooth</span><span class="o">=</span><span class="n">smooth</span><span class="p">,</span>
                    <span class="n">clvs</span><span class="o">=</span><span class="n">clvs</span><span class="p">,</span><span class="n">cmap</span><span class="o">=</span><span class="n">cmap</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="WRFEnviron.create_fname"><a class="viewcode-back" href="../../../../WEM.postWRF.postWRF.html#WEM.postWRF.postWRF.main.WRFEnviron.create_fname">[docs]</a>    <span class="k">def</span> <span class="nf">create_fname</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">vrbl</span><span class="p">,</span><span class="n">utc</span><span class="p">,</span><span class="n">level</span><span class="p">,</span><span class="n">f_prefix</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span><span class="n">f_suffix</span><span class="o">=</span><span class="bp">False</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Generate a filename (without extension) for saving a figure.</span>
<span class="sd">        Differentiate between similar plots for e.g. different domains by</span>
<span class="sd">        using the f_suffix/f_prefix options.</span>

<span class="sd">        :param vrbl:        variable name as found in WRF, or one of</span>
<span class="sd">                            the computed fields available in WEM.</span>
<span class="sd">        :type vrbl:         str</span>
<span class="sd">        :param utc:         one date/time. The tuple/list format is</span>
<span class="sd">                            YYYY,MM,DD,HH,MM,SS (ready for calendar.timegm).</span>
<span class="sd">                            Integer format is epoch/datenum (time.gmtime).</span>
<span class="sd">        :type utc:          tuple,list,int</span>
<span class="sd">        :param level:       required level.</span>
<span class="sd">        :type level:        str</span>
<span class="sd">        :param f_prefix:    custom filename prefix for output. Ignore if False.</span>
<span class="sd">        :type f_prefix:     bool,str</span>
<span class="sd">        :param f_suffix     custom filename suffix for output. Ignore if False.</span>
<span class="sd">        :type f_suffix      bool,str</span>

<span class="sd">        :returns:           str -- filename with extension.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">time_str</span> <span class="o">=</span> <span class="n">utils</span><span class="o">.</span><span class="n">string_from_time</span><span class="p">(</span><span class="s">&#39;output&#39;</span><span class="p">,</span><span class="n">utc</span><span class="p">)</span>

        <span class="n">fname</span> <span class="o">=</span> <span class="s">&#39;_&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">((</span><span class="n">vrbl</span><span class="p">,</span><span class="n">time_str</span><span class="p">,</span><span class="n">level</span><span class="p">))</span>

        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">f_prefix</span><span class="p">,</span><span class="nb">basestring</span><span class="p">):</span>
            <span class="n">fname</span> <span class="o">=</span> <span class="n">f_prefix</span> <span class="o">+</span> <span class="n">fname</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">f_suffix</span><span class="p">,</span><span class="nb">basestring</span><span class="p">):</span>
            <span class="n">fname</span> <span class="o">=</span> <span class="n">fname</span> <span class="o">+</span> <span class="n">f_suffix</span>
        <span class="k">return</span> <span class="n">fname</span>
</div>
<div class="viewcode-block" id="WRFEnviron.get_netcdf"><a class="viewcode-back" href="../../../../WEM.postWRF.postWRF.html#WEM.postWRF.postWRF.main.WRFEnviron.get_netcdf">[docs]</a>    <span class="k">def</span> <span class="nf">get_netcdf</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">ncdir</span><span class="p">,</span><span class="n">ncf</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span><span class="n">nct</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span><span class="n">dom</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="n">path_only</span><span class="o">=</span><span class="bp">False</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Returns the WRFOut, ECMWF, or RUC instance.</span>

<span class="sd">        :param ncdir:       absolute path to directory that contains the</span>
<span class="sd">                            netCDF file.</span>

<span class="sd">        :param ncf:         filename of netcdf data file if ambiguous within ncdir.</span>
<span class="sd">                            If no wrfout file is explicitly specified, the</span>
<span class="sd">                            netCDF file in that folder is chosen if unambiguous.</span>
<span class="sd">        :type ncf:          bool,str</span>
<span class="sd">        :param nct:         initialisation time of netcdf data file, if</span>
<span class="sd">                            ambiguous within ncdir.</span>
<span class="sd">        :type nct:          bool,str</span>
<span class="sd">        :param dom:         domain for plotting (for WRF data).</span>
<span class="sd">                            If zero, the only netCDF file present will be</span>
<span class="sd">                            plotted.</span>
<span class="sd">        :type dom:          int</span>
<span class="sd">        :param path_only:   if True, return only absolute path to file.</span>
<span class="sd">                            This is useful to loop over ensemble members and</span>
<span class="sd">                            generate a list of files.</span>
<span class="sd">        :type path_only:    bool</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">ncf</span><span class="p">:</span>
            <span class="n">fpath</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">ncdir</span><span class="p">,</span><span class="n">ncf</span><span class="p">)</span>
            <span class="n">model</span> <span class="o">=</span> <span class="n">utils</span><span class="o">.</span><span class="n">determine_model</span><span class="p">(</span><span class="n">ncf</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">fpath</span><span class="p">,</span> <span class="n">model</span> <span class="o">=</span> <span class="n">utils</span><span class="o">.</span><span class="n">netcdf_files_in</span><span class="p">(</span><span class="n">ncdir</span><span class="p">,</span><span class="n">init_time</span><span class="o">=</span><span class="n">nct</span><span class="p">,</span>
                                                    <span class="n">dom</span><span class="o">=</span><span class="n">dom</span><span class="p">,</span><span class="n">return_model</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>

        <span class="c"># import pdb; pdb.set_trace()</span>
        <span class="k">if</span> <span class="n">path_only</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">fpath</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c"># Check for WRF or RUC</span>
            <span class="c"># nc = Dataset(wrfpath)</span>
            <span class="c"># if &#39;ruc&#39; in nc.grib_source[:3]:</span>
            <span class="k">if</span> <span class="n">model</span><span class="o">==</span><span class="s">&#39;ruc&#39;</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">RUC</span><span class="p">(</span><span class="n">fpath</span><span class="p">)</span>
            <span class="k">elif</span> <span class="n">model</span><span class="o">==</span><span class="s">&#39;wrfout&#39;</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">WRFOut</span><span class="p">(</span><span class="n">fpath</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">print</span><span class="p">(</span><span class="s">&quot;Unrecognised netCDF4 file type at {0}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">fpath</span><span class="p">))</span>
</div>
<div class="viewcode-block" id="WRFEnviron.generate_times"><a class="viewcode-back" href="../../../../WEM.postWRF.postWRF.html#WEM.postWRF.postWRF.main.WRFEnviron.generate_times">[docs]</a>    <span class="k">def</span> <span class="nf">generate_times</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">itime</span><span class="p">,</span><span class="n">ftime</span><span class="p">,</span><span class="n">interval</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Wrapper for utility method</span>
<span class="sd">        :func:`WEM.utils.GIS_tools.generate_times`, so user can access</span>
<span class="sd">        this at the top level to loop over times.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">listoftimes</span> <span class="o">=</span> <span class="n">utils</span><span class="o">.</span><span class="n">generate_times</span><span class="p">(</span><span class="n">itime</span><span class="p">,</span><span class="n">ftime</span><span class="p">,</span><span class="n">interval</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">listoftimes</span>
</div>
<div class="viewcode-block" id="WRFEnviron.plot_diff_energy"><a class="viewcode-back" href="../../../../WEM.postWRF.postWRF.html#WEM.postWRF.postWRF.main.WRFEnviron.plot_diff_energy">[docs]</a>    <span class="k">def</span> <span class="nf">plot_diff_energy</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">vrbl</span><span class="p">,</span><span class="n">utc</span><span class="p">,</span><span class="n">energy</span><span class="p">,</span><span class="n">datadir</span><span class="p">,</span><span class="n">outdir</span><span class="p">,</span><span class="n">dataf</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span>
                            <span class="n">outprefix</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span><span class="n">outsuffix</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span><span class="n">clvs</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
                            <span class="n">title</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span><span class="n">fig</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span><span class="n">ax</span><span class="o">=</span><span class="bp">False</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        This function requires data already generated by</span>
<span class="sd">        :func:`WEM.postWRF.postWRF.stats.compute_diff_energy`.</span>

<span class="sd">        :param vrbl:    Vertically integrated (&#39;sum_z&#39;) or summated over all</span>
<span class="sd">                        dimensions (&#39;sum_xyz&#39;).</span>
<span class="sd">        :type vrbl:     str</span>
<span class="sd">        :param utc:     one date/time. The tuple/list format is</span>
<span class="sd">                        YYYY,MM,DD,HH,MM,SS (ready for calendar.timegm).</span>
<span class="sd">                        Integer format is epoch/datenum (ready for</span>
<span class="sd">                        time.gmtime).</span>
<span class="sd">        :type utc:      tuple,list,int</span>
<span class="sd">        :param energy:  DKE (&#39;kinetic&#39;) or DTE (&#39;total&#39;).</span>
<span class="sd">        :type energy:   str</span>
<span class="sd">        :param datadir: directory holding computed data</span>
<span class="sd">        :type datadir:  str</span>
<span class="sd">        :param outdir:  root directory for plots</span>
<span class="sd">        :type outdir:   str</span>
<span class="sd">        :param dataf:   file name of data file, if ambiguous</span>
<span class="sd">        :type dataf:    str</span>
<span class="sd">        :param f_prefix: custom filename prefix for output. Ignore if False.</span>
<span class="sd">        :type f_prefix: bool,str</span>
<span class="sd">        :param f_suffix: custom filename suffix for output. Ignore if False.</span>
<span class="sd">        :type f_suffix: bool,str</span>
<span class="sd">        :param clvs:    contour levels for plot. Generate with</span>
<span class="sd">                        :func:`numpy.arange`.</span>
<span class="sd">        :type clvs:     bool,N.ndarray</span>
<span class="sd">        :title:   title for output</span>
<span class="sd">        :param fig:         value of False will create new figure. A value of</span>
<span class="sd">                            matplotlib.figure object will plot data onto</span>
<span class="sd">                            this figure (similarly for axis, below).</span>
<span class="sd">        :type fig:          bool,matplotlib.figure</span>
<span class="sd">        :param ax:          matplotlib.axis object to plot onto</span>
<span class="sd">        :type ax:           bool,matplotlib.axis</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">DATA</span> <span class="o">=</span> <span class="n">utils</span><span class="o">.</span><span class="n">load_data</span><span class="p">(</span><span class="n">folder</span><span class="p">,</span><span class="n">fname</span><span class="p">,</span><span class="n">format</span><span class="o">=</span><span class="s">&#39;pickle&#39;</span><span class="p">)</span>

        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">utc</span><span class="p">,(</span><span class="nb">list</span><span class="p">,</span><span class="nb">tuple</span><span class="p">)):</span>
            <span class="n">utc</span> <span class="o">=</span> <span class="n">calendar</span><span class="o">.</span><span class="n">timegm</span><span class="p">(</span><span class="n">utc</span><span class="p">)</span>

        <span class="k">for</span> <span class="n">pn</span><span class="p">,</span><span class="n">perm</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">DATA</span><span class="p">):</span>
            <span class="n">f1</span> <span class="o">=</span> <span class="n">DATA</span><span class="p">[</span><span class="n">perm</span><span class="p">][</span><span class="s">&#39;file1&#39;</span><span class="p">]</span>
            <span class="n">f2</span> <span class="o">=</span> <span class="n">DATA</span><span class="p">[</span><span class="n">perm</span><span class="p">][</span><span class="s">&#39;file2&#39;</span><span class="p">]</span>
            <span class="c"># Get times and info about nc files</span>
            <span class="c"># First time to save power</span>
            <span class="n">W1</span> <span class="o">=</span> <span class="n">WRFOut</span><span class="p">(</span><span class="n">f1</span><span class="p">)</span>
            <span class="n">permtimes</span> <span class="o">=</span> <span class="n">DATA</span><span class="p">[</span><span class="n">perm</span><span class="p">][</span><span class="s">&#39;times&#39;</span><span class="p">]</span>

            <span class="c"># Find array for required time</span>
            <span class="n">x</span> <span class="o">=</span> <span class="n">N</span><span class="o">.</span><span class="n">where</span><span class="p">(</span><span class="n">N</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">permtimes</span><span class="p">)</span><span class="o">==</span><span class="n">utc</span><span class="p">)[</span><span class="mi">0</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
            <span class="n">data</span> <span class="o">=</span> <span class="n">DATA</span><span class="p">[</span><span class="n">perm</span><span class="p">][</span><span class="s">&#39;values&#39;</span><span class="p">][</span><span class="n">x</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">pn</span><span class="p">:</span>
                <span class="n">stack</span> <span class="o">=</span> <span class="n">data</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">stack</span> <span class="o">=</span> <span class="n">N</span><span class="o">.</span><span class="n">dstack</span><span class="p">((</span><span class="n">data</span><span class="p">,</span><span class="n">stack</span><span class="p">))</span>
                <span class="n">stack_average</span> <span class="o">=</span> <span class="n">N</span><span class="o">.</span><span class="n">average</span><span class="p">(</span><span class="n">stack</span><span class="p">,</span><span class="n">axis</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>

        <span class="n">kwargs1</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="n">kwargs2</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">if</span> <span class="n">ax</span><span class="p">:</span>
            <span class="n">kwargs1</span><span class="p">[</span><span class="s">&#39;ax&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">ax</span>
            <span class="n">kwargs2</span><span class="p">[</span><span class="s">&#39;save&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">if</span> <span class="n">title</span><span class="p">:</span>
            <span class="n">kwargs2</span><span class="p">[</span><span class="s">&#39;title&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>

        <span class="c">#birdseye plot with basemap of DKE/DTE</span>
        <span class="n">F</span> <span class="o">=</span> <span class="n">BirdsEye</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">C</span><span class="p">,</span><span class="n">W1</span><span class="p">,</span><span class="o">**</span><span class="n">kwargs1</span><span class="p">)</span>    <span class="c"># 2D figure class</span>
        <span class="n">tstr</span> <span class="o">=</span> <span class="n">utils</span><span class="o">.</span><span class="n">string_from_time</span><span class="p">(</span><span class="s">&#39;output&#39;</span><span class="p">,</span><span class="n">utc</span><span class="p">)</span>
        <span class="n">fname_t</span> <span class="o">=</span> <span class="s">&#39;&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">((</span><span class="n">plotname</span><span class="p">,</span><span class="s">&#39;_{0}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">tstr</span><span class="p">)))</span>

        <span class="n">fig_obj</span> <span class="o">=</span> <span class="n">F</span><span class="o">.</span><span class="n">plot_data</span><span class="p">(</span><span class="n">stack_average</span><span class="p">,</span><span class="s">&#39;contourf&#39;</span><span class="p">,</span><span class="n">p2p</span><span class="p">,</span><span class="n">fname_t</span><span class="p">,</span><span class="n">utc</span><span class="p">,</span><span class="n">V</span><span class="p">,</span>
                                <span class="o">**</span><span class="n">kwargs2</span><span class="p">)</span>

</div>
<div class="viewcode-block" id="WRFEnviron.delta_diff_energy"><a class="viewcode-back" href="../../../../WEM.postWRF.postWRF.html#WEM.postWRF.postWRF.main.WRFEnviron.delta_diff_energy">[docs]</a>    <span class="k">def</span> <span class="nf">delta_diff_energy</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">vrbl</span><span class="p">,</span><span class="n">utc0</span><span class="p">,</span><span class="n">utc1</span><span class="p">,</span><span class="n">energy</span><span class="p">,</span><span class="n">datadir</span><span class="p">,</span><span class="n">outdir</span><span class="p">,</span>
                            <span class="n">meanvrbl</span><span class="o">=</span><span class="s">&#39;Z&#39;</span><span class="p">,</span><span class="n">meanlevel</span><span class="o">=</span><span class="mi">500</span><span class="p">,</span>
                            <span class="n">dataf</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span><span class="n">outprefix</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span><span class="n">outsuffix</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span>
                            <span class="n">clvs</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span><span class="n">title</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span><span class="n">fig</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span><span class="n">ax</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span><span class="n">ncdata</span><span class="o">=</span><span class="bp">False</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Plot DKE/DTE growth with time, DDKE/DDTE (contours) over (optional)</span>
<span class="sd">        ensemble mean of a variable.</span>

<span class="sd">        Will calculate DDKE/DDTE for halfway between time0 and time1.</span>

<span class="sd">        vrbl        :   &#39;sum_z&#39; or &#39;sum_xyz&#39;</span>
<span class="sd">        utc0       :   first time, must exist in pickle file</span>
<span class="sd">        utc1       :   second time, ditto</span>
<span class="sd">        energy      :   &#39;kinetic&#39; or &#39;total&#39;</span>
<span class="sd">        datadir     :   directory holding computed data</span>
<span class="sd">        outdir      :   root directory for plots</span>

<span class="sd">        Optional</span>
<span class="sd">        meanvrbl    :   variable of ensemble mean</span>
<span class="sd">        meanlevel   :   level for ensemble mean variable</span>
<span class="sd">        ncdata      :   if meanvrbl is not False, link to all netcdf files of</span>
<span class="sd">                        ensemble members for ensemble</span>
<span class="sd">        dataf       :   file name of data file, if ambiguous</span>
<span class="sd">        outprefix   :   prefix for output files</span>
<span class="sd">        outsuffix   :   suffix for output files</span>
<span class="sd">        clvs        :   contour levels</span>
<span class="sd">        title       :   title for output</span>
<span class="sd">        fig         :   matplotlib.figure object to plot on</span>
<span class="sd">        ax          :   matplotib.axis object to plot on</span>

<span class="sd">        TODO: Interpolate geopotential height to pressure level.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">load_data</span><span class="p">(</span><span class="n">folder</span><span class="p">,</span><span class="n">fname</span><span class="p">,</span><span class="n">format</span><span class="o">=</span><span class="s">&#39;pickle&#39;</span><span class="p">)</span>

        <span class="k">for</span> <span class="n">n</span><span class="p">,</span> <span class="n">perm</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">data</span><span class="p">):</span>
            <span class="k">if</span> <span class="n">n</span><span class="o">==</span><span class="mi">0</span><span class="p">:</span>
                <span class="n">permtimes</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="n">perm</span><span class="p">][</span><span class="s">&#39;times&#39;</span><span class="p">]</span>
                <span class="n">deltatimes</span> <span class="o">=</span> <span class="p">[(</span><span class="n">t0</span><span class="o">+</span><span class="n">t1</span><span class="p">)</span><span class="o">/</span><span class="mf">2.0</span> <span class="k">for</span> <span class="n">t0</span><span class="p">,</span><span class="n">t1</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">permtimes</span><span class="p">[:</span><span class="o">-</span><span class="mi">2</span><span class="p">],</span><span class="n">permtimes</span><span class="p">[</span><span class="mi">1</span><span class="p">:])]</span>
                <span class="n">W1</span> <span class="o">=</span> <span class="n">WRFOut</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="n">perm</span><span class="p">][</span><span class="s">&#39;file1&#39;</span><span class="p">])</span>
                <span class="k">break</span>

        <span class="k">for</span> <span class="n">t</span><span class="p">,</span> <span class="n">delt</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">deltatimes</span><span class="p">):</span>
            <span class="k">print</span><span class="p">(</span><span class="s">&#39;Computing for time {0}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">time</span><span class="o">.</span><span class="n">gmtime</span><span class="p">(</span><span class="n">delt</span><span class="p">)))</span>
            <span class="k">for</span> <span class="n">n</span><span class="p">,</span> <span class="n">perm</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">data</span><span class="p">):</span>
                <span class="n">diff0</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="n">perm</span><span class="p">][</span><span class="s">&#39;values&#39;</span><span class="p">][</span><span class="n">t</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
                <span class="n">diff1</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="n">perm</span><span class="p">][</span><span class="s">&#39;values&#39;</span><span class="p">][</span><span class="n">t</span><span class="o">+</span><span class="mi">1</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
                <span class="k">if</span> <span class="n">n</span><span class="o">==</span><span class="mi">0</span><span class="p">:</span>
                    <span class="n">stack0</span> <span class="o">=</span> <span class="n">diff0</span>
                    <span class="n">stack1</span> <span class="o">=</span> <span class="n">diff1</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">stack0</span> <span class="o">=</span> <span class="n">N</span><span class="o">.</span><span class="n">dstack</span><span class="p">((</span><span class="n">diff0</span><span class="p">,</span><span class="n">stack0</span><span class="p">))</span>
                    <span class="n">stack1</span> <span class="o">=</span> <span class="n">N</span><span class="o">.</span><span class="n">dstack</span><span class="p">((</span><span class="n">diff1</span><span class="p">,</span><span class="n">stack1</span><span class="p">))</span>

            <span class="k">for</span> <span class="n">wnum</span><span class="p">,</span><span class="n">wrf</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">wrfouts</span><span class="p">):</span>
                <span class="n">W2</span> <span class="o">=</span> <span class="n">Dataset</span><span class="p">(</span><span class="n">wrf</span><span class="p">)</span>
                <span class="c">##### NEEDS REFACTORING #######</span>
                <span class="n">ght</span> <span class="o">=</span> <span class="n">TimeLevelLatLonWRF</span><span class="p">(</span><span class="n">W1</span><span class="o">.</span><span class="n">nc</span><span class="p">,</span><span class="n">W2</span><span class="p">,</span><span class="n">times</span><span class="o">=</span><span class="n">delt</span><span class="p">)</span>
                <span class="c">##### NEEDS REFACTORING #######</span>
                <span class="k">if</span> <span class="n">wnum</span><span class="o">==</span><span class="mi">0</span><span class="p">:</span>
                    <span class="n">ghtstack</span> <span class="o">=</span> <span class="n">ght</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">ghtstack</span> <span class="o">=</span> <span class="n">N</span><span class="o">.</span><span class="n">dstack</span><span class="p">((</span><span class="n">ght</span><span class="p">,</span><span class="n">ghtstack</span><span class="p">))</span>

            <span class="n">heightmean</span> <span class="o">=</span> <span class="n">N</span><span class="o">.</span><span class="n">average</span><span class="p">(</span><span class="n">ghtstack</span><span class="p">,</span><span class="n">axis</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>

            <span class="n">delta</span> <span class="o">=</span> <span class="n">N</span><span class="o">.</span><span class="n">average</span><span class="p">(</span><span class="n">stack1</span><span class="p">,</span><span class="n">axis</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span> <span class="o">-</span> <span class="n">N</span><span class="o">.</span><span class="n">average</span><span class="p">(</span><span class="n">stack0</span><span class="p">,</span><span class="n">axis</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>

            <span class="n">F</span> <span class="o">=</span> <span class="n">BirdsEye</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">C</span><span class="p">,</span> <span class="n">W1</span><span class="p">)</span>
            <span class="n">tstr</span> <span class="o">=</span> <span class="n">utils</span><span class="o">.</span><span class="n">string_from_time</span><span class="p">(</span><span class="s">&#39;output&#39;</span><span class="p">,</span><span class="nb">int</span><span class="p">(</span><span class="n">delt</span><span class="p">))</span>
            <span class="n">fname_t</span> <span class="o">=</span> <span class="s">&#39;&#39;</span><span class="o">.</span><span class="n">join</span><span class="p">((</span><span class="n">plotname</span><span class="p">,</span><span class="s">&#39;_{0}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">tstr</span><span class="p">)))</span>
            <span class="n">F</span><span class="o">.</span><span class="n">plot_data</span><span class="p">(</span><span class="n">delta</span><span class="p">,</span><span class="s">&#39;contourf&#39;</span><span class="p">,</span><span class="n">p2p</span><span class="p">,</span><span class="n">fname_t</span><span class="p">,</span><span class="n">delt</span><span class="p">,</span>
                        <span class="n">save</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span><span class="n">levels</span><span class="o">=</span><span class="n">N</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="o">-</span><span class="mi">2000</span><span class="p">,</span><span class="mi">2200</span><span class="p">,</span><span class="mi">200</span><span class="p">))</span>
            <span class="n">F</span><span class="o">.</span><span class="n">plot_data</span><span class="p">(</span><span class="n">heightmean</span><span class="p">,</span><span class="s">&#39;contour&#39;</span><span class="p">,</span><span class="n">p2p</span><span class="p">,</span><span class="n">fname_t</span><span class="p">,</span><span class="n">delt</span><span class="p">,</span>
                       <span class="n">colors</span><span class="o">=</span><span class="s">&#39;k&#39;</span><span class="p">,</span><span class="n">levels</span><span class="o">=</span><span class="n">N</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">2700</span><span class="p">,</span><span class="mi">3930</span><span class="p">,</span><span class="mi">30</span><span class="p">))</span>
</div>
<div class="viewcode-block" id="WRFEnviron.plot_error_growth"><a class="viewcode-back" href="../../../../WEM.postWRF.postWRF.html#WEM.postWRF.postWRF.main.WRFEnviron.plot_error_growth">[docs]</a>    <span class="k">def</span> <span class="nf">plot_error_growth</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">datadir</span><span class="p">,</span><span class="n">outprefix</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span><span class="n">dataf</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span>
                            <span class="n">sensitivity</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span><span class="n">ylim</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span><span class="n">outsuffix</span><span class="o">=</span><span class="bp">False</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Plots line graphs of DKE/DTE error growth</span>
<span class="sd">        varying by a sensitivity - e.g. error growth involving</span>
<span class="sd">        all members that use a certain parameterisation.</span>

<span class="sd">        datadir         :   folder with pickle data</span>

<span class="sd">        Optional</span>
<span class="sd">        outprefix       :   output filename prefix</span>
<span class="sd">        dataf           :   pickle filename if ambiguous</span>
<span class="sd">        plotlist        :   list of folder names to loop over</span>
<span class="sd">        ylim            :   tuple of min/max for y axis range</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">DATA</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">load_data</span><span class="p">(</span><span class="n">folder</span><span class="p">,</span><span class="n">pfname</span><span class="p">,</span><span class="n">format</span><span class="o">=</span><span class="s">&#39;pickle&#39;</span><span class="p">)</span>

        <span class="k">for</span> <span class="n">perm</span> <span class="ow">in</span> <span class="n">DATA</span><span class="p">:</span>
            <span class="n">times</span> <span class="o">=</span> <span class="n">DATA</span><span class="p">[</span><span class="n">perm</span><span class="p">][</span><span class="s">&#39;times&#39;</span><span class="p">]</span>
            <span class="k">break</span>

        <span class="n">times_tup</span> <span class="o">=</span> <span class="p">[</span><span class="n">time</span><span class="o">.</span><span class="n">gmtime</span><span class="p">(</span><span class="n">t</span><span class="p">)</span> <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="n">times</span><span class="p">]</span>
        <span class="n">time_str</span> <span class="o">=</span> <span class="p">[</span><span class="s">&quot;{2:02d}/{3:02d}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="o">*</span><span class="n">t</span><span class="p">)</span> <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="n">times_tup</span><span class="p">]</span>

        <span class="k">if</span> <span class="n">sensitivity</span><span class="p">:</span>
            <span class="c"># Plot multiple line charts for each sensitivity</span>
            <span class="c"># Then a final chart with all the averages</span>
            <span class="c"># If data is 2D, sum over x/y to get one number</span>

            <span class="c"># Dictionary with average</span>
            <span class="n">AVE</span> <span class="o">=</span> <span class="p">{}</span>

            <span class="k">for</span> <span class="n">sens</span> <span class="ow">in</span> <span class="n">sensitivity</span><span class="p">:</span>
                <span class="n">ave_stack</span> <span class="o">=</span> <span class="mi">0</span>
                <span class="n">n_sens</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">sensitivity</span><span class="p">)</span><span class="o">-</span><span class="mi">1</span>
                <span class="n">colourlist</span> <span class="o">=</span> <span class="n">utils</span><span class="o">.</span><span class="n">generate_colours</span><span class="p">(</span><span class="n">M</span><span class="p">,</span><span class="n">n_sens</span><span class="p">)</span>
                <span class="n">M</span><span class="o">.</span><span class="n">rcParams</span><span class="p">[</span><span class="s">&#39;axes.color_cycle&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">colourlist</span>
                <span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">()</span>
                <span class="n">labels</span> <span class="o">=</span> <span class="p">[]</span>
                <span class="c">#SENS[&#39;sens&#39;] = {}</span>
                <span class="k">for</span> <span class="n">perm</span> <span class="ow">in</span> <span class="n">DATA</span><span class="p">:</span>
                    <span class="n">f1</span> <span class="o">=</span> <span class="n">DATA</span><span class="p">[</span><span class="n">perm</span><span class="p">][</span><span class="s">&#39;file1&#39;</span><span class="p">]</span>
                    <span class="n">f2</span> <span class="o">=</span> <span class="n">DATA</span><span class="p">[</span><span class="n">perm</span><span class="p">][</span><span class="s">&#39;file2&#39;</span><span class="p">]</span>

                    <span class="k">if</span> <span class="n">sens</span> <span class="ow">in</span> <span class="n">f1</span><span class="p">:</span>
                        <span class="n">f</span> <span class="o">=</span> <span class="n">f2</span>
                    <span class="k">elif</span> <span class="n">sens</span> <span class="ow">in</span> <span class="n">f2</span><span class="p">:</span>
                        <span class="n">f</span> <span class="o">=</span> <span class="n">f1</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">f</span> <span class="o">=</span> <span class="mi">0</span>

                    <span class="k">if</span> <span class="n">f</span><span class="p">:</span>
                        <span class="n">subdirs</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s">&#39;/&#39;</span><span class="p">)</span>
                        <span class="n">labels</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">subdirs</span><span class="p">[</span><span class="o">-</span><span class="mi">2</span><span class="p">])</span>
                        <span class="n">data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">make_1D</span><span class="p">(</span><span class="n">DATA</span><span class="p">[</span><span class="n">perm</span><span class="p">][</span><span class="s">&#39;values&#39;</span><span class="p">])</span>

                        <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">times</span><span class="p">,</span><span class="n">data</span><span class="p">)</span>
                        <span class="c"># pdb.set_trace()</span>
                        <span class="n">ave_stack</span> <span class="o">=</span> <span class="n">utils</span><span class="o">.</span><span class="n">vstack_loop</span><span class="p">(</span><span class="n">N</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">data</span><span class="p">),</span><span class="n">ave_stack</span><span class="p">)</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="k">pass</span>

                <span class="c"># pdb.set_trace()</span>
                <span class="n">n_sens</span> <span class="o">+=</span> <span class="mi">1</span>
                <span class="n">colourlist</span> <span class="o">=</span> <span class="n">utils</span><span class="o">.</span><span class="n">generate_colours</span><span class="p">(</span><span class="n">M</span><span class="p">,</span><span class="n">n_sens</span><span class="p">)</span>
                <span class="n">M</span><span class="o">.</span><span class="n">rcParams</span><span class="p">[</span><span class="s">&#39;axes.color_cycle&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">colourlist</span>
                <span class="n">AVE</span><span class="p">[</span><span class="n">sens</span><span class="p">]</span> <span class="o">=</span> <span class="n">N</span><span class="o">.</span><span class="n">average</span><span class="p">(</span><span class="n">ave_stack</span><span class="p">,</span><span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
                <span class="n">labels</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s">&#39;Average&#39;</span><span class="p">)</span>
                <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">times</span><span class="p">,</span><span class="n">AVE</span><span class="p">[</span><span class="n">sens</span><span class="p">],</span><span class="s">&#39;k&#39;</span><span class="p">)</span>

                <span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">labels</span><span class="p">,</span><span class="n">loc</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span><span class="n">fontsize</span><span class="o">=</span><span class="mi">9</span><span class="p">)</span>
                <span class="k">if</span> <span class="n">ylimits</span><span class="p">:</span>
                    <span class="n">plt</span><span class="o">.</span><span class="n">ylim</span><span class="p">(</span><span class="n">ylimits</span><span class="p">)</span>
                <span class="n">plt</span><span class="o">.</span><span class="n">gca</span><span class="p">()</span><span class="o">.</span><span class="n">set_xticks</span><span class="p">(</span><span class="n">times</span><span class="p">[::</span><span class="mi">2</span><span class="p">])</span>
                <span class="n">plt</span><span class="o">.</span><span class="n">gca</span><span class="p">()</span><span class="o">.</span><span class="n">set_xticklabels</span><span class="p">(</span><span class="n">time_str</span><span class="p">[::</span><span class="mi">2</span><span class="p">])</span>
                <span class="n">outdir</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">C</span><span class="o">.</span><span class="n">output_root</span>
                <span class="n">fname</span> <span class="o">=</span> <span class="s">&#39;{0}_Growth_{1}.png&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">ofname</span><span class="p">,</span><span class="n">sens</span><span class="p">)</span>
                <span class="n">fpath</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">outdir</span><span class="p">,</span><span class="n">fname</span><span class="p">)</span>
                <span class="n">fig</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="n">fpath</span><span class="p">)</span>

                <span class="n">plt</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
                <span class="k">print</span><span class="p">(</span><span class="s">&quot;Saved {0}.&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">fpath</span><span class="p">))</span>

            <span class="c"># Averages for each sensitivity</span>
            <span class="n">labels</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">()</span>
            <span class="n">ave_of_ave_stack</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="k">for</span> <span class="n">sens</span> <span class="ow">in</span> <span class="n">AVE</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
                <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">times</span><span class="p">,</span><span class="n">AVE</span><span class="p">[</span><span class="n">sens</span><span class="p">])</span>
                <span class="n">labels</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">sens</span><span class="p">)</span>
                <span class="n">ave_of_ave_stack</span> <span class="o">=</span> <span class="n">utils</span><span class="o">.</span><span class="n">vstack_loop</span><span class="p">(</span><span class="n">AVE</span><span class="p">[</span><span class="n">sens</span><span class="p">],</span><span class="n">ave_of_ave_stack</span><span class="p">)</span>

            <span class="n">labels</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s">&#39;Average&#39;</span><span class="p">)</span>
            <span class="n">ave_of_ave</span> <span class="o">=</span> <span class="n">N</span><span class="o">.</span><span class="n">average</span><span class="p">(</span><span class="n">ave_of_ave_stack</span><span class="p">,</span><span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">times</span><span class="p">,</span><span class="n">ave_of_ave</span><span class="p">,</span><span class="s">&#39;k&#39;</span><span class="p">)</span>

            <span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">(</span><span class="n">labels</span><span class="p">,</span><span class="n">loc</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span><span class="n">fontsize</span><span class="o">=</span><span class="mi">9</span><span class="p">)</span>

            <span class="k">if</span> <span class="n">ylimits</span><span class="p">:</span>
                <span class="n">plt</span><span class="o">.</span><span class="n">ylim</span><span class="p">(</span><span class="n">ylimits</span><span class="p">)</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">gca</span><span class="p">()</span><span class="o">.</span><span class="n">set_xticks</span><span class="p">(</span><span class="n">times</span><span class="p">[::</span><span class="mi">2</span><span class="p">])</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">gca</span><span class="p">()</span><span class="o">.</span><span class="n">set_xticklabels</span><span class="p">(</span><span class="n">time_str</span><span class="p">[::</span><span class="mi">2</span><span class="p">])</span>
            <span class="n">outdir</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">C</span><span class="o">.</span><span class="n">output_root</span>
            <span class="n">fname</span> <span class="o">=</span> <span class="s">&#39;{0}_Growth_Averages.png&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">ofname</span><span class="p">)</span>
            <span class="n">fpath</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">outdir</span><span class="p">,</span><span class="n">fname</span><span class="p">)</span>
            <span class="n">fig</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="n">fpath</span><span class="p">)</span>

            <span class="n">plt</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
            <span class="k">print</span><span class="p">(</span><span class="s">&quot;Saved {0}.&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">fpath</span><span class="p">))</span>
            <span class="c">#pdb.set_trace()</span>



        <span class="k">else</span><span class="p">:</span>
            <span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">()</span>
            <span class="n">ave_stack</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="k">for</span> <span class="n">perm</span> <span class="ow">in</span> <span class="n">DATA</span><span class="p">:</span>
                <span class="n">data</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">make_1D</span><span class="p">(</span><span class="n">DATA</span><span class="p">[</span><span class="n">perm</span><span class="p">][</span><span class="s">&#39;values&#39;</span><span class="p">])</span>
                <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">times</span><span class="p">,</span><span class="n">data</span><span class="p">,</span><span class="s">&#39;blue&#39;</span><span class="p">)</span>
                <span class="n">ave_stack</span> <span class="o">=</span> <span class="n">utils</span><span class="o">.</span><span class="n">vstack_loop</span><span class="p">(</span><span class="n">N</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="n">data</span><span class="p">),</span><span class="n">ave_stack</span><span class="p">)</span>

            <span class="n">total_ave</span> <span class="o">=</span> <span class="n">N</span><span class="o">.</span><span class="n">average</span><span class="p">(</span><span class="n">ave_stack</span><span class="p">,</span><span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">times</span><span class="p">,</span><span class="n">total_ave</span><span class="p">,</span><span class="s">&#39;black&#39;</span><span class="p">)</span>

            <span class="k">if</span> <span class="n">ylimits</span><span class="p">:</span>
                <span class="n">plt</span><span class="o">.</span><span class="n">ylim</span><span class="p">(</span><span class="n">ylimits</span><span class="p">)</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">gca</span><span class="p">()</span><span class="o">.</span><span class="n">set_xticks</span><span class="p">(</span><span class="n">times</span><span class="p">[::</span><span class="mi">2</span><span class="p">])</span>
            <span class="n">plt</span><span class="o">.</span><span class="n">gca</span><span class="p">()</span><span class="o">.</span><span class="n">set_xticklabels</span><span class="p">(</span><span class="n">time_str</span><span class="p">[::</span><span class="mi">2</span><span class="p">])</span>
            <span class="n">outdir</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">C</span><span class="o">.</span><span class="n">output_root</span>
            <span class="n">fname</span> <span class="o">=</span> <span class="s">&#39;{0}_Growth_allmembers.png&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">ofname</span><span class="p">)</span>
            <span class="n">fpath</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">outdir</span><span class="p">,</span><span class="n">fname</span><span class="p">)</span>
            <span class="n">fig</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="n">fpath</span><span class="p">)</span>

            <span class="n">plt</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
            <span class="k">print</span><span class="p">(</span><span class="s">&quot;Saved {0}.&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">fpath</span><span class="p">))</span>
</div>
<div class="viewcode-block" id="WRFEnviron.composite_profile"><a class="viewcode-back" href="../../../../WEM.postWRF.postWRF.html#WEM.postWRF.postWRF.main.WRFEnviron.composite_profile">[docs]</a>    <span class="k">def</span> <span class="nf">composite_profile</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">va</span><span class="p">,</span><span class="n">utc</span><span class="p">,</span><span class="n">latlon</span><span class="p">,</span><span class="n">enspaths</span><span class="p">,</span>
                            <span class="n">dom</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span><span class="n">mean</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span><span class="n">std</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span><span class="n">xlim</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span><span class="n">ylim</span><span class="o">=</span><span class="mi">0</span><span class="p">):</span>
        <span class="n">P</span> <span class="o">=</span> <span class="n">Profile</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">C</span><span class="p">)</span>
        <span class="n">P</span><span class="o">.</span><span class="n">composite_profile</span><span class="p">(</span><span class="n">va</span><span class="p">,</span><span class="n">utc</span><span class="p">,</span><span class="n">latlon</span><span class="p">,</span><span class="n">enspaths</span><span class="p">,</span><span class="n">dom</span><span class="p">,</span><span class="n">mean</span><span class="p">,</span><span class="n">std</span><span class="p">,</span><span class="n">xlim</span><span class="p">,</span><span class="n">ylim</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="WRFEnviron.twopanel_profile"><a class="viewcode-back" href="../../../../WEM.postWRF.postWRF.html#WEM.postWRF.postWRF.main.WRFEnviron.twopanel_profile">[docs]</a>    <span class="k">def</span> <span class="nf">twopanel_profile</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">va</span><span class="p">,</span><span class="n">utc</span><span class="p">,</span><span class="n">wrf_sds</span><span class="p">,</span><span class="n">out_sd</span><span class="p">,</span><span class="n">two_panel</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="n">dom</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="n">mean</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="n">std</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
                         <span class="n">xlim</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span><span class="n">ylim</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span><span class="n">latlon</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span><span class="n">locname</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span><span class="n">overlay</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span><span class="n">ml</span><span class="o">=-</span><span class="mi">2</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Create two-panel figure with profile location on map,</span>
<span class="sd">        with profile of all ensemble members in comparison.</span>

<span class="sd">        Inputs:</span>
<span class="sd">        va          :   variable for profile</span>
<span class="sd">        utc        :   time of plot</span>
<span class="sd">        wrf_sds     :   subdirs containing wrf file</span>
<span class="sd">        out_d       :   out directory for plots</span>

<span class="sd">        Optional:</span>
<span class="sd">        two_panel   :   add inset for plot location</span>
<span class="sd">        dom         :   WRF domain to use</span>
<span class="sd">        mean        :   overlay mean on profile</span>
<span class="sd">        std         :   overlay +/- std dev on profile</span>
<span class="sd">        xlim        :   three-item list/tuple with limits, spacing interval</span>
<span class="sd">                        for xaxis, in whatever default units</span>
<span class="sd">        ylim        :   similarly for yaxis but in hPa</span>
<span class="sd">                        or dictionary with locations (METAR etc) and two-item tuple</span>
<span class="sd">        latlon      :   two-item list/tuple with lat/lon.</span>
<span class="sd">                        If not specified, use pop-ups to select.</span>
<span class="sd">        locname     :   pass this to the filename of output for saving</span>
<span class="sd">        overlay     :   data from the same time to overlay on inset</span>
<span class="sd">        ml          :   member level. negative number that corresponds to the</span>
<span class="sd">                        folder in absolute string for naming purposes.</span>


<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c"># Initialise with first wrfout file</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">W</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_netcdf</span><span class="p">(</span><span class="n">wrf_sds</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="n">dom</span><span class="o">=</span><span class="n">dom</span><span class="p">)</span>
        <span class="n">outpath</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_outpath</span><span class="p">(</span><span class="n">out_sd</span><span class="p">)</span>

        <span class="c"># Get list of all wrfout files</span>
        <span class="n">enspaths</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">list_ncfiles</span><span class="p">(</span><span class="n">wrf_sds</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">data</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">if</span> <span class="n">two_panel</span><span class="p">:</span>
            <span class="n">P2</span> <span class="o">=</span> <span class="n">Figure</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">C</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">W</span><span class="p">,</span><span class="n">layout</span><span class="o">=</span><span class="s">&#39;inseth&#39;</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">overlay</span><span class="p">:</span>
                <span class="n">F</span> <span class="o">=</span> <span class="n">BirdsEye</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">C</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">W</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">data</span> <span class="o">=</span> <span class="n">F</span><span class="o">.</span><span class="n">plot2D</span><span class="p">(</span><span class="s">&#39;cref&#39;</span><span class="p">,</span><span class="n">utc</span><span class="p">,</span><span class="mi">2000</span><span class="p">,</span><span class="n">dom</span><span class="p">,</span><span class="n">outpath</span><span class="p">,</span><span class="n">save</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span><span class="n">return_data</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>

        <span class="c"># TODO: Not sure basemap inset works for lat/lon specified</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">latlon</span><span class="p">,</span><span class="n">collections</span><span class="o">.</span><span class="n">Sequence</span><span class="p">):</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="nb">len</span><span class="p">(</span><span class="n">latlon</span><span class="p">)</span> <span class="o">==</span> <span class="mi">2</span><span class="p">:</span>
                <span class="k">print</span><span class="p">(</span><span class="s">&quot;Latitude and longitude needs to be two-item list/tuple.&quot;</span><span class="p">)</span>
                <span class="k">raise</span> <span class="ne">Exception</span>
            <span class="n">lat0</span><span class="p">,</span><span class="n">lon0</span> <span class="o">=</span> <span class="n">latlon</span>
            <span class="n">C</span> <span class="o">=</span> <span class="n">Clicker</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">C</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">W</span><span class="p">,</span><span class="n">fig</span><span class="o">=</span><span class="n">P2</span><span class="o">.</span><span class="n">fig</span><span class="p">,</span><span class="n">ax</span><span class="o">=</span><span class="n">P2</span><span class="o">.</span><span class="n">ax0</span><span class="p">,</span><span class="n">data</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">)</span>
            <span class="n">x0</span><span class="p">,</span> <span class="n">y0</span> <span class="o">=</span> <span class="n">C</span><span class="o">.</span><span class="n">bmap</span><span class="p">(</span><span class="n">lon0</span><span class="p">,</span><span class="n">lat0</span><span class="p">)</span>
            <span class="n">C</span><span class="o">.</span><span class="n">ax</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">x0</span><span class="p">,</span><span class="n">y0</span><span class="p">,</span><span class="n">marker</span><span class="o">=</span><span class="s">&#39;x&#39;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">t_long</span> <span class="o">=</span> <span class="n">utils</span><span class="o">.</span><span class="n">string_from_time</span><span class="p">(</span><span class="s">&#39;output&#39;</span><span class="p">,</span><span class="n">utc</span><span class="p">)</span>
            <span class="k">print</span><span class="p">(</span><span class="s">&quot;Pick location for {0}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">t_long</span><span class="p">))</span>
            <span class="n">C</span> <span class="o">=</span> <span class="n">Clicker</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">C</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">W</span><span class="p">,</span><span class="n">fig</span><span class="o">=</span><span class="n">P2</span><span class="o">.</span><span class="n">fig</span><span class="p">,</span><span class="n">ax</span><span class="o">=</span><span class="n">P2</span><span class="o">.</span><span class="n">ax0</span><span class="p">,</span><span class="n">data</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">)</span>
            <span class="c"># fig should be P2.fig.</span>
            <span class="c"># C.fig.tight_layout()</span>

            <span class="c"># Pick location for profile</span>
            <span class="n">C</span><span class="o">.</span><span class="n">click_x_y</span><span class="p">(</span><span class="n">plotpoint</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
            <span class="n">lon0</span><span class="p">,</span> <span class="n">lat0</span> <span class="o">=</span> <span class="n">C</span><span class="o">.</span><span class="n">bmap</span><span class="p">(</span><span class="n">C</span><span class="o">.</span><span class="n">x0</span><span class="p">,</span><span class="n">C</span><span class="o">.</span><span class="n">y0</span><span class="p">,</span><span class="n">inverse</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>


        <span class="c"># Compute profile</span>
        <span class="n">P</span> <span class="o">=</span> <span class="n">Profile</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">C</span><span class="p">)</span>
        <span class="n">P</span><span class="o">.</span><span class="n">composite_profile</span><span class="p">(</span><span class="n">va</span><span class="p">,</span><span class="n">utc</span><span class="p">,(</span><span class="n">lat0</span><span class="p">,</span><span class="n">lon0</span><span class="p">),</span><span class="n">enspaths</span><span class="p">,</span><span class="n">outpath</span><span class="p">,</span><span class="n">dom</span><span class="o">=</span><span class="n">dom</span><span class="p">,</span><span class="n">mean</span><span class="o">=</span><span class="n">mean</span><span class="p">,</span>
                            <span class="n">std</span><span class="o">=</span><span class="n">std</span><span class="p">,</span><span class="n">xlim</span><span class="o">=</span><span class="n">xlim</span><span class="p">,</span><span class="n">ylim</span><span class="o">=</span><span class="n">ylim</span><span class="p">,</span><span class="n">fig</span><span class="o">=</span><span class="n">P2</span><span class="o">.</span><span class="n">fig</span><span class="p">,</span><span class="n">ax</span><span class="o">=</span><span class="n">P2</span><span class="o">.</span><span class="n">ax1</span><span class="p">,</span>
                            <span class="n">locname</span><span class="o">=</span><span class="n">locname</span><span class="p">,</span><span class="n">ml</span><span class="o">=</span><span class="n">ml</span><span class="p">)</span>

</div>
<div class="viewcode-block" id="WRFEnviron.plot_skewT"><a class="viewcode-back" href="../../../../WEM.postWRF.postWRF.html#WEM.postWRF.postWRF.main.WRFEnviron.plot_skewT">[docs]</a>    <span class="k">def</span> <span class="nf">plot_skewT</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">utc</span><span class="p">,</span><span class="n">latlon</span><span class="p">,</span><span class="n">out_sd</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span><span class="n">wrf_sd</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span><span class="n">dom</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="n">save_output</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span><span class="n">composite</span><span class="o">=</span><span class="mi">0</span><span class="p">):</span>

        <span class="n">outpath</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_outpath</span><span class="p">(</span><span class="n">out_sd</span><span class="p">)</span>
        <span class="n">W</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_netcdf</span><span class="p">(</span><span class="n">wrf_sd</span><span class="p">,</span><span class="n">dom</span><span class="o">=</span><span class="n">dom</span><span class="p">)</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="n">composite</span><span class="p">:</span>
            <span class="n">ST</span> <span class="o">=</span> <span class="n">SkewT</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">C</span><span class="p">,</span><span class="n">W</span><span class="p">)</span>
            <span class="n">ST</span><span class="o">.</span><span class="n">plot_skewT</span><span class="p">(</span><span class="n">utc</span><span class="p">,</span><span class="n">plot_latlon</span><span class="p">,</span><span class="n">dom</span><span class="p">,</span><span class="n">outpath</span><span class="p">,</span><span class="n">save_output</span><span class="o">=</span><span class="n">save_output</span><span class="p">)</span>
            <span class="n">nice_time</span> <span class="o">=</span> <span class="n">utils</span><span class="o">.</span><span class="n">string_from_time</span><span class="p">(</span><span class="s">&#39;title&#39;</span><span class="p">,</span><span class="n">utc</span><span class="p">)</span>
            <span class="k">print</span><span class="p">(</span><span class="s">&quot;Plotted Skew-T for time {0} at {1}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
                        <span class="n">nice_time</span><span class="p">,</span><span class="n">plot_latlon</span><span class="p">))</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c">#ST = SkewT(self.C)</span>
            <span class="k">pass</span>
</div>
<div class="viewcode-block" id="WRFEnviron.plot_streamlines"><a class="viewcode-back" href="../../../../WEM.postWRF.postWRF.html#WEM.postWRF.postWRF.main.WRFEnviron.plot_streamlines">[docs]</a>    <span class="k">def</span> <span class="nf">plot_streamlines</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">utc</span><span class="p">,</span><span class="n">level</span><span class="p">,</span><span class="n">ncdir</span><span class="p">,</span><span class="n">outdir</span><span class="p">,</span><span class="n">ncf</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span><span class="n">nct</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span>
                            <span class="n">f_prefix</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span><span class="n">f_suffix</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span><span class="n">dom</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="n">smooth</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
                            <span class="n">fig</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span><span class="n">ax</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span><span class="n">bounding</span><span class="o">=</span><span class="bp">False</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Doc me.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">level</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_level_string</span><span class="p">(</span><span class="n">level</span><span class="p">)</span>
        <span class="c"># Data</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">W</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_netcdf</span><span class="p">(</span><span class="n">ncdir</span><span class="p">,</span><span class="n">ncf</span><span class="o">=</span><span class="n">ncf</span><span class="p">,</span><span class="n">nct</span><span class="o">=</span><span class="n">nct</span><span class="p">,</span><span class="n">dom</span><span class="o">=</span><span class="n">dom</span><span class="p">)</span>
        <span class="n">lats</span><span class="p">,</span> <span class="n">lons</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">W</span><span class="o">.</span><span class="n">get_limited_domain</span><span class="p">(</span><span class="n">bounding</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">level</span><span class="o">==</span><span class="s">&#39;2000hPa&#39;</span><span class="p">:</span>
            <span class="n">U</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">W</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;U10&#39;</span><span class="p">,</span><span class="n">utc</span><span class="p">,</span><span class="n">level</span><span class="p">,</span><span class="n">lons</span><span class="p">,</span><span class="n">lats</span><span class="p">)[</span><span class="mi">0</span><span class="p">,:,:]</span>
            <span class="n">V</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">W</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;V10&#39;</span><span class="p">,</span><span class="n">utc</span><span class="p">,</span><span class="n">level</span><span class="p">,</span><span class="n">lons</span><span class="p">,</span><span class="n">lats</span><span class="p">)[</span><span class="mi">0</span><span class="p">,:,:]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">U</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">W</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;U&#39;</span><span class="p">,</span><span class="n">utc</span><span class="p">,</span><span class="n">level</span><span class="p">,</span><span class="n">lons</span><span class="p">,</span><span class="n">lats</span><span class="p">)[</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,:,:]</span>
            <span class="n">V</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">W</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s">&#39;V&#39;</span><span class="p">,</span><span class="n">utc</span><span class="p">,</span><span class="n">level</span><span class="p">,</span><span class="n">lons</span><span class="p">,</span><span class="n">lats</span><span class="p">)[</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,:,:]</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">F</span> <span class="o">=</span> <span class="n">BirdsEye</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">W</span><span class="p">,</span><span class="n">fig</span><span class="o">=</span><span class="n">fig</span><span class="p">,</span><span class="n">ax</span><span class="o">=</span><span class="n">ax</span><span class="p">)</span>
        <span class="c"># disp_t = utils.string_from_time(&#39;title&#39;,utc)</span>
        <span class="c"># print(&quot;Plotting {0} at lv {1} for time {2}.&quot;.format(</span>
                <span class="c"># &#39;streamlines&#39;,lv,disp_t))</span>
        <span class="n">fname</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">create_fname</span><span class="p">(</span><span class="s">&#39;streamlines&#39;</span><span class="p">,</span><span class="n">utc</span><span class="p">,</span><span class="n">level</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">F</span><span class="o">.</span><span class="n">plot_streamlines</span><span class="p">(</span><span class="n">U</span><span class="p">,</span><span class="n">V</span><span class="p">,</span><span class="n">outdir</span><span class="p">,</span><span class="n">fname</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="WRFEnviron.plot_strongest_wind"><a class="viewcode-back" href="../../../../WEM.postWRF.postWRF.html#WEM.postWRF.postWRF.main.WRFEnviron.plot_strongest_wind">[docs]</a>    <span class="k">def</span> <span class="nf">plot_strongest_wind</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">itime</span><span class="p">,</span><span class="n">ftime</span><span class="p">,</span><span class="n">levels</span><span class="p">,</span><span class="n">wrf_sd</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span><span class="n">wrf_nc</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span><span class="n">out_sd</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span><span class="n">f_prefix</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span><span class="n">f_suffix</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
                <span class="n">bounding</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span><span class="n">dom</span><span class="o">=</span><span class="mi">0</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Plot strongest wind at level lv between itime and ftime.</span>

<span class="sd">        Path to wrfout file is in config file.</span>
<span class="sd">        Path to plot output is also in config</span>


<span class="sd">        Inputs:</span>
<span class="sd">        levels      :   level(s) for wind</span>
<span class="sd">        wrf_sd      :   string - subdirectory of wrfout file</span>
<span class="sd">        wrf_nc      :   filename of wrf file requested.</span>
<span class="sd">                            If no wrfout file is explicitly specified, the</span>
<span class="sd">                            netCDF file in that folder is chosen if unambiguous.</span>
<span class="sd">        out_sd      :   subdirectory of output .png.</span>
<span class="sd">        f_prefix    :   custom filename prefix</span>
<span class="sd">        f_suffix    :   custom filename suffix</span>
<span class="sd">        bounding    :   list of four floats (Nlim, Elim, Slim, Wlim):</span>
<span class="sd">            Nlim    :   northern limit</span>
<span class="sd">            Elim    :   eastern limit</span>
<span class="sd">            Slim    :   southern limit</span>
<span class="sd">            Wlim    :   western limit</span>
<span class="sd">        smooth      :   smoothing. 0 is off. non-zero integer is the degree</span>
<span class="sd">                        of smoothing, to be specified.</span>
<span class="sd">        dom         :   domain for plotting. If zero, the only netCDF file present</span>
<span class="sd">                        will be plotted. If list of integers, the script will loop over domains.</span>


<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">W</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_netcdf</span><span class="p">(</span><span class="n">wrf_sd</span><span class="p">,</span><span class="n">wrf_nc</span><span class="p">,</span><span class="n">dom</span><span class="o">=</span><span class="n">dom</span><span class="p">)</span>

        <span class="n">outpath</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_outpath</span><span class="p">(</span><span class="n">out_sd</span><span class="p">)</span>

        <span class="c"># Make sure times are in datenum format and sequence.</span>
        <span class="n">it</span> <span class="o">=</span> <span class="n">utils</span><span class="o">.</span><span class="n">ensure_sequence_datenum</span><span class="p">(</span><span class="n">itime</span><span class="p">)</span>
        <span class="n">ft</span> <span class="o">=</span> <span class="n">utils</span><span class="o">.</span><span class="n">ensure_sequence_datenum</span><span class="p">(</span><span class="n">ftime</span><span class="p">)</span>

        <span class="n">d_list</span> <span class="o">=</span> <span class="n">utils</span><span class="o">.</span><span class="n">get_sequence</span><span class="p">(</span><span class="n">dom</span><span class="p">)</span>
        <span class="n">lv_list</span> <span class="o">=</span> <span class="n">utils</span><span class="o">.</span><span class="n">get_sequence</span><span class="p">(</span><span class="n">levels</span><span class="p">)</span>

        <span class="k">for</span> <span class="n">l</span><span class="p">,</span> <span class="n">d</span> <span class="ow">in</span> <span class="n">itertools</span><span class="o">.</span><span class="n">product</span><span class="p">(</span><span class="n">lv_list</span><span class="p">,</span><span class="n">d_list</span><span class="p">):</span>
            <span class="n">F</span> <span class="o">=</span> <span class="n">BirdsEye</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">C</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">W</span><span class="p">)</span>
            <span class="n">F</span><span class="o">.</span><span class="n">plot2D</span><span class="p">(</span><span class="s">&#39;strongestwind&#39;</span><span class="p">,</span><span class="n">it</span><span class="o">+</span><span class="n">ft</span><span class="p">,</span><span class="n">l</span><span class="p">,</span><span class="n">d</span><span class="p">,</span><span class="n">outpath</span><span class="p">,</span><span class="n">bounding</span><span class="o">=</span><span class="n">bounding</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="WRFEnviron.make_1D"><a class="viewcode-back" href="../../../../WEM.postWRF.postWRF.html#WEM.postWRF.postWRF.main.WRFEnviron.make_1D">[docs]</a>    <span class="k">def</span> <span class="nf">make_1D</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">data</span><span class="p">,</span><span class="n">output</span><span class="o">=</span><span class="s">&#39;list&#39;</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot; Make sure data is a time series</span>
<span class="sd">        of 1D values, and numpy array.</span>

<span class="sd">        List of arrays -&gt; Numpy array or list</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">data</span><span class="p">,</span><span class="nb">list</span><span class="p">):</span>

            <span class="n">data_list</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">for</span> <span class="n">utc</span> <span class="ow">in</span> <span class="n">data</span><span class="p">:</span>
                <span class="n">data_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">N</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">utc</span><span class="p">[</span><span class="mi">0</span><span class="p">]))</span>

            <span class="k">if</span> <span class="n">output</span> <span class="o">==</span> <span class="s">&#39;array&#39;</span><span class="p">:</span>
                <span class="n">data_out</span> <span class="o">=</span> <span class="n">N</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">data_list</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">data_out</span> <span class="o">=</span> <span class="n">data_list</span>


        <span class="c">#elif isinstance(data,N.array):</span>
        <span class="c">#    shape = data.shape</span>
        <span class="c">#    if len(shape) == 1:</span>
        <span class="c">#        data_out = data</span>
        <span class="c">#    elif len(shape) == 2:</span>
        <span class="c">#        data_out = N.sum(data)</span>
        <span class="k">return</span> <span class="n">data_out</span>

</div>
<div class="viewcode-block" id="WRFEnviron.get_list"><a class="viewcode-back" href="../../../../WEM.postWRF.postWRF.html#WEM.postWRF.postWRF.main.WRFEnviron.get_list">[docs]</a>    <span class="k">def</span> <span class="nf">get_list</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">dic</span><span class="p">,</span><span class="n">key</span><span class="p">,</span><span class="n">default</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Fetch value from dictionary.</span>

<span class="sd">        If it doesn&#39;t exist, use default.</span>
<span class="sd">        If the value is an integer, make a list of one.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">val</span> <span class="o">=</span> <span class="nb">getattr</span><span class="p">(</span><span class="n">dic</span><span class="p">,</span><span class="n">key</span><span class="p">,</span><span class="n">default</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">val</span><span class="p">,</span><span class="s">&#39;int&#39;</span><span class="p">):</span>
            <span class="n">lst</span> <span class="o">=</span> <span class="p">(</span><span class="n">val</span><span class="p">,)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">lst</span> <span class="o">=</span> <span class="n">val</span>
        <span class="k">return</span> <span class="n">lst</span>

</div>
<div class="viewcode-block" id="WRFEnviron.plot_xs"><a class="viewcode-back" href="../../../../WEM.postWRF.postWRF.html#WEM.postWRF.postWRF.main.WRFEnviron.plot_xs">[docs]</a>    <span class="k">def</span> <span class="nf">plot_xs</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">vrbl</span><span class="p">,</span><span class="n">utc</span><span class="p">,</span><span class="n">latA</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span><span class="n">lonA</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span><span class="n">latB</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span><span class="n">lonB</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
                <span class="n">wrf_sd</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span><span class="n">wrf_nc</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span><span class="n">out_sd</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span><span class="n">f_prefix</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span><span class="n">f_suffix</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span><span class="n">dom</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
                <span class="n">clvs</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span><span class="n">ztop</span><span class="o">=</span><span class="mi">0</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Plot cross-section.</span>

<span class="sd">        If no lat/lon transect is indicated, a popup appears for the user</span>
<span class="sd">        to pick points. The popup can have an overlaid field such as reflectivity</span>
<span class="sd">        to help with the process.</span>

<span class="sd">        Inputs:</span>
<span class="sd">        vrbl        :   variable to be plotted</span>
<span class="sd">        utc       :   times to be plotted</span>
<span class="sd">        latA        :   start latitude of transect</span>
<span class="sd">        lonA        :   start longitude of transect</span>
<span class="sd">        latB        :   end lat...</span>
<span class="sd">        lonB        :   end lon...</span>
<span class="sd">        wrf_sd      :   string - subdirectory of wrfout file</span>
<span class="sd">        wrf_nc      :   filename of wrf file requested.</span>
<span class="sd">                            If no wrfout file is explicitly specified, the</span>
<span class="sd">                            netCDF file in that folder is chosen if unambiguous.</span>
<span class="sd">        out_sd      :   subdirectory of output .png.</span>
<span class="sd">        f_prefix    :   custom filename prefix</span>
<span class="sd">        f_suffix    :   custom filename suffix</span>
<span class="sd">        clvs        :   custom contour levels</span>
<span class="sd">        ztop        :   highest km to plot.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">W</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_netcdf</span><span class="p">(</span><span class="n">wrf_sd</span><span class="p">,</span><span class="n">wrf_nc</span><span class="p">,</span><span class="n">dom</span><span class="o">=</span><span class="n">dom</span><span class="p">)</span>

        <span class="n">outpath</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_outpath</span><span class="p">(</span><span class="n">out_sd</span><span class="p">)</span>

        <span class="n">XS</span> <span class="o">=</span> <span class="n">CrossSection</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">C</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">W</span><span class="p">,</span><span class="n">latA</span><span class="p">,</span><span class="n">lonA</span><span class="p">,</span><span class="n">latB</span><span class="p">,</span><span class="n">lonB</span><span class="p">)</span>

        <span class="n">XS</span><span class="o">.</span><span class="n">plot_xs</span><span class="p">(</span><span class="n">vrbl</span><span class="p">,</span><span class="n">utc</span><span class="p">,</span><span class="n">outpath</span><span class="p">,</span><span class="n">clvs</span><span class="o">=</span><span class="n">clvs</span><span class="p">,</span><span class="n">ztop</span><span class="o">=</span><span class="n">ztop</span><span class="p">)</span>

</div>
<div class="viewcode-block" id="WRFEnviron.cold_pool_strength"><a class="viewcode-back" href="../../../../WEM.postWRF.postWRF.html#WEM.postWRF.postWRF.main.WRFEnviron.cold_pool_strength">[docs]</a>    <span class="k">def</span> <span class="nf">cold_pool_strength</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">utc</span><span class="p">,</span><span class="n">wrf_sd</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span><span class="n">wrf_nc</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span><span class="n">out_sd</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
                            <span class="n">swath_width</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span><span class="n">dom</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="n">twoplot</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span><span class="n">fig</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span>
                            <span class="n">axes</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span><span class="n">dz</span><span class="o">=</span><span class="mi">0</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Pick A, B points on sim ref overlay</span>
<span class="sd">        This sets the angle between north and line AB</span>
<span class="sd">        Also sets the length in along-line direction</span>
<span class="sd">        For every gridpt along line AB:</span>
<span class="sd">            Locate gust front via shear</span>
<span class="sd">            Starting at front, do 3-grid-pt-average in line-normal</span>
<span class="sd">            direction</span>

<span class="sd">        utc    :   time (tuple or datenum) to plot</span>
<span class="sd">        wrf_sd  :   string - subdirectory of wrfout file</span>
<span class="sd">        wrf_nc  :   filename of wrf file requested.</span>
<span class="sd">                            If no wrfout file is explicitly specified, the</span>
<span class="sd">                            netCDF file in that folder is chosen if unambiguous.</span>
<span class="sd">        out_sd      :   subdirectory of output .png.</span>
<span class="sd">        swath_width :   length in gridpoints in cross-section-normal direction</span>
<span class="sd">        dom     :   domain number</span>
<span class="sd">        return2 :   return two figures. cold pool strength and cref/cross-section.</span>
<span class="sd">        axes    :   if two-length tuple, this is the first and second axes for</span>
<span class="sd">                    cross-section/cref and cold pool strength, respectively</span>
<span class="sd">        dz      :   plot height of cold pool only.</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c"># Initialise</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">W</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_netcdf</span><span class="p">(</span><span class="n">wrf_sd</span><span class="p">,</span><span class="n">wrf_nc</span><span class="p">,</span><span class="n">dom</span><span class="o">=</span><span class="n">dom</span><span class="p">)</span>
        <span class="n">outpath</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_outpath</span><span class="p">(</span><span class="n">out_sd</span><span class="p">)</span>

        <span class="c"># keyword arguments for plots</span>
        <span class="n">line_kwargs</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="n">cps_kwargs</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="c"># Create two-panel figure</span>
        <span class="k">if</span> <span class="n">twoplot</span><span class="p">:</span>
            <span class="n">P2</span> <span class="o">=</span> <span class="n">Figure</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">C</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">W</span><span class="p">,</span><span class="n">plotn</span><span class="o">=</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span><span class="mi">2</span><span class="p">))</span>
            <span class="n">line_kwargs</span><span class="p">[</span><span class="s">&#39;ax&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">P2</span><span class="o">.</span><span class="n">ax</span><span class="o">.</span><span class="n">flat</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
            <span class="n">line_kwargs</span><span class="p">[</span><span class="s">&#39;fig&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">P2</span><span class="o">.</span><span class="n">fig</span>
            <span class="n">P2</span><span class="o">.</span><span class="n">ax</span><span class="o">.</span><span class="n">flat</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">set_size_inches</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span><span class="mi">3</span><span class="p">)</span>

            <span class="n">cps_kwargs</span><span class="p">[</span><span class="s">&#39;ax&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">P2</span><span class="o">.</span><span class="n">ax</span><span class="o">.</span><span class="n">flat</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
            <span class="n">cps_kwargs</span><span class="p">[</span><span class="s">&#39;fig&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">P2</span><span class="o">.</span><span class="n">fig</span>
            <span class="n">P2</span><span class="o">.</span><span class="n">ax</span><span class="o">.</span><span class="n">flat</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">set_size_inches</span><span class="p">(</span><span class="mi">6</span><span class="p">,</span><span class="mi">6</span><span class="p">)</span>

        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">axes</span><span class="p">,</span><span class="nb">tuple</span><span class="p">)</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="n">axes</span><span class="p">)</span><span class="o">==</span><span class="mi">2</span><span class="p">:</span>
            <span class="n">line_kwargs</span><span class="p">[</span><span class="s">&#39;ax&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">axes</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
            <span class="n">line_kwargs</span><span class="p">[</span><span class="s">&#39;fig&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">fig</span>

            <span class="n">cps_kwargs</span><span class="p">[</span><span class="s">&#39;ax&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">axes</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
            <span class="n">cps_kwargs</span><span class="p">[</span><span class="s">&#39;fig&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">fig</span>

            <span class="n">return_ax</span> <span class="o">=</span> <span class="mi">1</span>

        <span class="c"># Plot sim ref, send basemap axis to clicker function</span>
        <span class="n">F</span> <span class="o">=</span> <span class="n">BirdsEye</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">C</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">W</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">data</span> <span class="o">=</span> <span class="n">F</span><span class="o">.</span><span class="n">plot2D</span><span class="p">(</span><span class="s">&#39;cref&#39;</span><span class="p">,</span><span class="n">utc</span><span class="p">,</span><span class="mi">2000</span><span class="p">,</span><span class="n">dom</span><span class="p">,</span><span class="n">outpath</span><span class="p">,</span><span class="n">save</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span><span class="n">return_data</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>

        <span class="n">C</span> <span class="o">=</span> <span class="n">Clicker</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">C</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">W</span><span class="p">,</span><span class="n">data</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">data</span><span class="p">,</span><span class="o">**</span><span class="n">line_kwargs</span><span class="p">)</span>
        <span class="c"># C.fig.tight_layout()</span>

        <span class="c"># Line from front to back of system</span>
        <span class="n">C</span><span class="o">.</span><span class="n">draw_line</span><span class="p">()</span>
        <span class="c"># C.draw_box()</span>
        <span class="n">lon0</span><span class="p">,</span> <span class="n">lat0</span> <span class="o">=</span> <span class="n">C</span><span class="o">.</span><span class="n">bmap</span><span class="p">(</span><span class="n">C</span><span class="o">.</span><span class="n">x0</span><span class="p">,</span><span class="n">C</span><span class="o">.</span><span class="n">y0</span><span class="p">,</span><span class="n">inverse</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
        <span class="n">lon1</span><span class="p">,</span> <span class="n">lat1</span> <span class="o">=</span> <span class="n">C</span><span class="o">.</span><span class="n">bmap</span><span class="p">(</span><span class="n">C</span><span class="o">.</span><span class="n">x1</span><span class="p">,</span><span class="n">C</span><span class="o">.</span><span class="n">y1</span><span class="p">,</span><span class="n">inverse</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>

        <span class="c"># Pick location for environmental dpt</span>
        <span class="c"># C.click_x_y()</span>
        <span class="c"># Here, it is the end of the cross-section</span>
        <span class="n">lon_env</span><span class="p">,</span> <span class="n">lat_env</span> <span class="o">=</span> <span class="n">C</span><span class="o">.</span><span class="n">bmap</span><span class="p">(</span><span class="n">C</span><span class="o">.</span><span class="n">x1</span><span class="p">,</span> <span class="n">C</span><span class="o">.</span><span class="n">y1</span><span class="p">,</span> <span class="n">inverse</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
        <span class="n">y_env</span><span class="p">,</span><span class="n">x_env</span><span class="p">,</span><span class="n">exactlat</span><span class="p">,</span><span class="n">exactlon</span> <span class="o">=</span> <span class="n">utils</span><span class="o">.</span><span class="n">getXY</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">W</span><span class="o">.</span><span class="n">lats1D</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">W</span><span class="o">.</span><span class="n">lons1D</span><span class="p">,</span><span class="n">lat_env</span><span class="p">,</span><span class="n">lon_env</span><span class="p">)</span>
        <span class="c"># Create the cross-section object</span>
        <span class="n">X</span> <span class="o">=</span> <span class="n">CrossSection</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">C</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">W</span><span class="p">,</span><span class="n">lat0</span><span class="p">,</span><span class="n">lon0</span><span class="p">,</span><span class="n">lat1</span><span class="p">,</span><span class="n">lon1</span><span class="p">)</span>

        <span class="c"># Ask user the line-normal box width (self.km)</span>
        <span class="c">#C.set_box_width(X)</span>

        <span class="c"># Compute the grid (DX x DY)</span>
        <span class="n">cps</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">W</span><span class="o">.</span><span class="n">cold_pool_strength</span><span class="p">(</span><span class="n">X</span><span class="p">,</span><span class="n">utc</span><span class="p">,</span><span class="n">swath_width</span><span class="o">=</span><span class="n">swath_width</span><span class="p">,</span><span class="n">env</span><span class="o">=</span><span class="p">(</span><span class="n">x_env</span><span class="p">,</span><span class="n">y_env</span><span class="p">),</span><span class="n">dz</span><span class="o">=</span><span class="n">dz</span><span class="p">)</span>
        <span class="c"># import pdb; pdb.set_trace()</span>

        <span class="c"># Plot this array</span>
        <span class="n">CPfig</span> <span class="o">=</span> <span class="n">BirdsEye</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">C</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">W</span><span class="p">,</span><span class="o">**</span><span class="n">cps_kwargs</span><span class="p">)</span>
        <span class="n">tstr</span> <span class="o">=</span> <span class="n">utils</span><span class="o">.</span><span class="n">string_from_time</span><span class="p">(</span><span class="s">&#39;output&#39;</span><span class="p">,</span><span class="n">utc</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">dz</span><span class="p">:</span>
            <span class="n">fprefix</span> <span class="o">=</span> <span class="s">&#39;ColdPoolDepth_&#39;</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">fprefix</span> <span class="o">=</span> <span class="s">&#39;ColdPoolStrength_&#39;</span>
        <span class="n">fname</span> <span class="o">=</span> <span class="n">fprefix</span> <span class="o">+</span> <span class="n">tstr</span>

        <span class="n">pdb</span><span class="o">.</span><span class="n">set_trace</span><span class="p">()</span>
        <span class="c"># imfig,imax = plt.subplots(1)</span>
        <span class="c"># imax.imshow(cps)</span>
        <span class="c"># plt.show(imfig)</span>
        <span class="c"># CPfig.plot_data(cps,&#39;contourf&#39;,outpath,fname,time,V=N.arange(5,105,5))</span>
        <span class="n">mplcommand</span> <span class="o">=</span> <span class="s">&#39;contour&#39;</span>
        <span class="n">plotkwargs</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">if</span> <span class="n">dz</span><span class="p">:</span>
            <span class="n">clvs</span> <span class="o">=</span> <span class="n">N</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">100</span><span class="p">,</span><span class="mi">5100</span><span class="p">,</span><span class="mi">100</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">clvs</span> <span class="o">=</span> <span class="n">N</span><span class="o">.</span><span class="n">arange</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span><span class="mi">85</span><span class="p">,</span><span class="mf">2.5</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">mplcommand</span><span class="p">[:</span><span class="mi">7</span><span class="p">]</span> <span class="o">==</span> <span class="s">&#39;contour&#39;</span><span class="p">:</span>
            <span class="n">plotkwargs</span><span class="p">[</span><span class="s">&#39;levels&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">clvs</span>
            <span class="n">plotkwargs</span><span class="p">[</span><span class="s">&#39;cmap&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">cm</span><span class="o">.</span><span class="n">ocean_r</span>
        <span class="n">cf2</span> <span class="o">=</span> <span class="n">CPfig</span><span class="o">.</span><span class="n">plot_data</span><span class="p">(</span><span class="n">cps</span><span class="p">,</span><span class="n">mplcommand</span><span class="p">,</span><span class="n">outpath</span><span class="p">,</span><span class="n">fname</span><span class="p">,</span><span class="n">utc</span><span class="p">,</span><span class="o">**</span><span class="n">plotkwargs</span><span class="p">)</span>
        <span class="c"># CPfig.fig.tight_layout()</span>

        <span class="n">plt</span><span class="o">.</span><span class="n">close</span><span class="p">(</span><span class="n">fig</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">twoplot</span><span class="p">:</span>
            <span class="n">P2</span><span class="o">.</span><span class="n">save</span><span class="p">(</span><span class="n">outpath</span><span class="p">,</span><span class="n">fname</span><span class="o">+</span><span class="s">&quot;_twopanel&quot;</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">return_ax</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">C</span><span class="o">.</span><span class="n">cf</span><span class="p">,</span> <span class="n">cf2</span>
</div>
<div class="viewcode-block" id="WRFEnviron.spaghetti"><a class="viewcode-back" href="../../../../WEM.postWRF.postWRF.html#WEM.postWRF.postWRF.main.WRFEnviron.spaghetti">[docs]</a>    <span class="k">def</span> <span class="nf">spaghetti</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">utc</span><span class="p">,</span><span class="n">lv</span><span class="p">,</span><span class="n">va</span><span class="p">,</span><span class="n">contour</span><span class="p">,</span><span class="n">wrf_sds</span><span class="p">,</span><span class="n">out_sd</span><span class="p">,</span><span class="n">dom</span><span class="o">=</span><span class="mi">1</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Do a multi-member spaghetti plot.</span>

<span class="sd">        utc       :   time for plot</span>
<span class="sd">        va      :   variable in question</span>
<span class="sd">        contour :   value to contour for each member</span>
<span class="sd">        wrf_sds :   list of wrf subdirs to loop over</span>
<span class="sd">        out_sd  :   directory to save image</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">outpath</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_outpath</span><span class="p">(</span><span class="n">out_sd</span><span class="p">)</span>

        <span class="c"># Use first wrfout to initialise grid etc</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">W</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_netcdf</span><span class="p">(</span><span class="n">wrf_sds</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="n">dom</span><span class="o">=</span><span class="n">dom</span><span class="p">)</span>
        <span class="n">F</span> <span class="o">=</span> <span class="n">BirdsEye</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">C</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">W</span><span class="p">)</span>

        <span class="n">ncfiles</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">wrf_sd</span> <span class="ow">in</span> <span class="n">wrf_sds</span><span class="p">:</span>
            <span class="n">ncfile</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_netcdf</span><span class="p">(</span><span class="n">wrf_sd</span><span class="p">,</span><span class="n">dom</span><span class="o">=</span><span class="n">dom</span><span class="p">,</span><span class="n">path_only</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
            <span class="n">ncfiles</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">ncfile</span><span class="p">)</span>

        <span class="n">F</span><span class="o">.</span><span class="n">spaghetti</span><span class="p">(</span><span class="n">utc</span><span class="p">,</span><span class="n">lv</span><span class="p">,</span><span class="n">va</span><span class="p">,</span><span class="n">contour</span><span class="p">,</span><span class="n">ncfiles</span><span class="p">,</span><span class="n">outpath</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="WRFEnviron.std"><a class="viewcode-back" href="../../../../WEM.postWRF.postWRF.html#WEM.postWRF.postWRF.main.WRFEnviron.std">[docs]</a>    <span class="k">def</span> <span class="nf">std</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">vrbl</span><span class="p">,</span><span class="n">utc</span><span class="p">,</span><span class="n">level</span><span class="p">,</span><span class="n">outdir</span><span class="p">,</span><span class="n">wrfdirs</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span><span class="n">wrfpaths</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span><span class="n">dom</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
                <span class="n">clvs</span><span class="o">=</span><span class="bp">False</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Compute standard deviation of all members</span>
<span class="sd">        for given variable.</span>

<span class="sd">        Inputs:</span>
<span class="sd">        utc     :   time</span>
<span class="sd">        level      :   level</span>
<span class="sd">        va      :   variable</span>

<span class="sd">        Must have one of these two:</span>
<span class="sd">        wrfdirs :   list of wrf dirs to loop over</span>

<span class="sd">        Optional</span>
<span class="sd">        out_sd  :   directory in which to save image</span>
<span class="sd">        clvs    :   user-set contour levels</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">wrfdirs</span> <span class="ow">is</span> <span class="bp">False</span> <span class="ow">and</span> <span class="n">wrfpaths</span> <span class="ow">is</span> <span class="bp">False</span><span class="p">:</span>
            <span class="k">print</span><span class="p">(</span><span class="s">&quot;Must have either wrfdirs or wrfpaths.&quot;</span><span class="p">)</span>
            <span class="k">raise</span> <span class="ne">Exception</span>
        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">wrfdirs</span><span class="p">,(</span><span class="nb">tuple</span><span class="p">,</span><span class="nb">list</span><span class="p">)):</span>
            <span class="n">ncfiles</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">list_ncfiles</span><span class="p">(</span><span class="n">wrf_sds</span><span class="p">)</span>
        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">wrfpaths</span><span class="p">,(</span><span class="nb">tuple</span><span class="p">,</span><span class="nb">list</span><span class="p">)):</span>
            <span class="n">ncfiles</span> <span class="o">=</span> <span class="n">wrfpaths</span>

        <span class="c"># Use first wrfout to initialise grid, get indices</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">W</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_netcdf</span><span class="p">(</span><span class="n">ncfiles</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span><span class="n">dom</span><span class="o">=</span><span class="n">dom</span><span class="p">)</span>

        <span class="n">tidx</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">W</span><span class="o">.</span><span class="n">get_time_idx</span><span class="p">(</span><span class="n">utc</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">lv</span><span class="o">==</span><span class="mi">2000</span><span class="p">:</span>
            <span class="c"># lvidx = None</span>
            <span class="n">lvidx</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">print</span><span class="p">(</span><span class="s">&quot;Only support surface right now&quot;</span><span class="p">)</span>
            <span class="k">raise</span> <span class="ne">Exception</span>

        <span class="n">std_data</span> <span class="o">=</span> <span class="n">stats</span><span class="o">.</span><span class="n">std</span><span class="p">(</span><span class="n">ncfiles</span><span class="p">,</span><span class="n">va</span><span class="p">,</span><span class="n">tidx</span><span class="p">,</span><span class="n">lvidx</span><span class="p">)</span>

        <span class="n">F</span> <span class="o">=</span> <span class="n">BirdsEye</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">C</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">W</span><span class="p">)</span>
        <span class="n">t_name</span> <span class="o">=</span> <span class="n">utils</span><span class="o">.</span><span class="n">string_from_time</span><span class="p">(</span><span class="s">&#39;output&#39;</span><span class="p">,</span><span class="n">t</span><span class="p">)</span>
        <span class="n">fname_t</span> <span class="o">=</span> <span class="s">&#39;std_{0}_{1}&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">va</span><span class="p">,</span><span class="n">t_name</span><span class="p">)</span>

        <span class="c"># pdb.set_trace()</span>
        <span class="n">plotkwargs</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="n">plotkwargs</span><span class="p">[</span><span class="s">&#39;no_title&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">clvs</span><span class="p">,</span><span class="n">N</span><span class="o">.</span><span class="n">ndarray</span><span class="p">):</span>
            <span class="n">plotkwargs</span><span class="p">[</span><span class="s">&#39;clvs&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">clvs</span>
        <span class="n">F</span><span class="o">.</span><span class="n">plot_data</span><span class="p">(</span><span class="n">std_data</span><span class="p">,</span><span class="s">&#39;contourf&#39;</span><span class="p">,</span><span class="n">outpath</span><span class="p">,</span><span class="n">fname_t</span><span class="p">,</span><span class="n">t</span><span class="p">,</span><span class="o">**</span><span class="n">plotkwargs</span><span class="p">)</span>
        <span class="k">print</span><span class="p">(</span><span class="s">&quot;Plotting std dev for {0} at time {1}&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">va</span><span class="p">,</span><span class="n">t_name</span><span class="p">))</span>
</div>
<div class="viewcode-block" id="WRFEnviron.list_ncfiles"><a class="viewcode-back" href="../../../../WEM.postWRF.postWRF.html#WEM.postWRF.postWRF.main.WRFEnviron.list_ncfiles">[docs]</a>    <span class="k">def</span> <span class="nf">list_ncfiles</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">wrf_sds</span><span class="p">,</span><span class="n">dom</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="n">path_only</span><span class="o">=</span><span class="mi">1</span><span class="p">):</span>
        <span class="n">ncfiles</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">wrf_sd</span> <span class="ow">in</span> <span class="n">wrf_sds</span><span class="p">:</span>
            <span class="n">ncfile</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_netcdf</span><span class="p">(</span><span class="n">wrf_sd</span><span class="p">,</span><span class="n">dom</span><span class="o">=</span><span class="n">dom</span><span class="p">,</span><span class="n">path_only</span><span class="o">=</span><span class="n">path_only</span><span class="p">)</span>
            <span class="n">ncfiles</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">ncfile</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">ncfiles</span>
</div>
<div class="viewcode-block" id="WRFEnviron.plot_domains"><a class="viewcode-back" href="../../../../WEM.postWRF.postWRF.html#WEM.postWRF.postWRF.main.WRFEnviron.plot_domains">[docs]</a>    <span class="k">def</span> <span class="nf">plot_domains</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">wrfouts</span><span class="p">,</span><span class="n">labels</span><span class="p">,</span><span class="n">latlons</span><span class="p">,</span><span class="n">out_sd</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span><span class="n">colour</span><span class="o">=</span><span class="mi">0</span><span class="p">):</span>
        <span class="n">outpath</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_outpath</span><span class="p">(</span><span class="n">out_sd</span><span class="p">)</span>
        <span class="n">maps</span><span class="o">.</span><span class="n">plot_domains</span><span class="p">(</span><span class="n">wrfouts</span><span class="p">,</span><span class="n">labels</span><span class="p">,</span><span class="n">latlons</span><span class="p">,</span><span class="n">outpath</span><span class="p">,</span><span class="n">colour</span><span class="p">)</span>

</div>
<div class="viewcode-block" id="WRFEnviron.frontogenesis"><a class="viewcode-back" href="../../../../WEM.postWRF.postWRF.html#WEM.postWRF.postWRF.main.WRFEnviron.frontogenesis">[docs]</a>    <span class="k">def</span> <span class="nf">frontogenesis</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">utc</span><span class="p">,</span><span class="n">level</span><span class="p">,</span><span class="n">ncdir</span><span class="p">,</span><span class="n">outdir</span><span class="p">,</span><span class="n">ncf</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span><span class="n">nct</span><span class="o">=</span><span class="bp">False</span><span class="p">,</span>
                        <span class="n">dom</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span><span class="n">smooth</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span><span class="n">clvs</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span><span class="n">title</span><span class="o">=</span><span class="mi">0</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Compute and plot (Miller?) frontogenesis as d/dt of theta gradient.</span>

<span class="sd">        Use a centred-in-time derivative; hence, if</span>
<span class="sd">        time index is start or end of wrfout file, skip the plot.</span>

<span class="sd">        smooth      :   gaussian smooth by this many grid points</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">W</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_netcdf</span><span class="p">(</span><span class="n">ncdir</span><span class="p">,</span><span class="n">ncf</span><span class="o">=</span><span class="n">ncf</span><span class="p">,</span><span class="n">nct</span><span class="o">=</span><span class="n">nct</span><span class="p">,</span><span class="n">dom</span><span class="o">=</span><span class="n">dom</span><span class="p">)</span>
        <span class="n">fname</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">create_fname</span><span class="p">(</span><span class="n">vrbl</span><span class="p">,</span><span class="n">utc</span><span class="p">,</span><span class="n">level</span><span class="p">)</span>

        <span class="n">Front</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">W</span><span class="o">.</span><span class="n">compute_frontogenesis</span><span class="p">(</span><span class="n">utc</span><span class="p">,</span><span class="n">level</span><span class="p">)</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">Front</span><span class="p">,</span><span class="n">N</span><span class="o">.</span><span class="n">ndarray</span><span class="p">):</span>

            <span class="k">if</span> <span class="n">smooth</span><span class="p">:</span>
                <span class="n">Front</span> <span class="o">=</span> <span class="n">stats</span><span class="o">.</span><span class="n">gauss_smooth</span><span class="p">(</span><span class="n">Front</span><span class="p">,</span><span class="n">smooth</span><span class="p">)</span>

            <span class="k">if</span> <span class="n">level</span><span class="o">==</span><span class="mi">2000</span><span class="p">:</span>
                <span class="n">lv_str</span> <span class="o">=</span> <span class="s">&#39;sfc&#39;</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">lv_str</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">level</span><span class="p">)</span>

                <span class="n">F</span> <span class="o">=</span> <span class="n">BirdsEye</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">C</span><span class="p">,</span><span class="bp">self</span><span class="o">.</span><span class="n">W</span><span class="p">)</span>
                <span class="n">fname</span> <span class="o">=</span> <span class="s">&#39;frontogen_{0}_{1}.png&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">lv_str</span><span class="p">,</span><span class="n">tstr</span><span class="p">)</span>
                <span class="n">F</span><span class="o">.</span><span class="n">plot_data</span><span class="p">(</span><span class="n">Front</span><span class="p">,</span><span class="s">&#39;contourf&#39;</span><span class="p">,</span><span class="n">outpath</span><span class="p">,</span><span class="n">fname</span><span class="p">,</span><span class="n">time</span><span class="p">,</span><span class="n">clvs</span><span class="o">=</span><span class="n">clvs</span><span class="p">,</span>
                            <span class="n">no_title</span><span class="o">=</span><span class="n">no_title</span><span class="p">,</span><span class="o">**</span><span class="n">kwargs</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">print</span><span class="p">(</span><span class="s">&quot;Skipping this time; at start or end of run.&quot;</span><span class="p">)</span>
</div>
<div class="viewcode-block" id="WRFEnviron.get_level_string"><a class="viewcode-back" href="../../../../WEM.postWRF.postWRF.html#WEM.postWRF.postWRF.main.WRFEnviron.get_level_string">[docs]</a>    <span class="k">def</span> <span class="nf">get_level_string</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span><span class="n">level</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Makes sure user&#39;s level input is a string.</span>
<span class="sd">        Saves typing hPa for the common usage of pressure levels.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">level</span><span class="p">,</span><span class="nb">int</span><span class="p">):</span>
            <span class="c"># Level is in pressure</span>
            <span class="n">level</span> <span class="o">=</span> <span class="s">&#39;{0}hPa&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">level</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">level</span></div></div>
</pre></div>

          </div>
        </div>
      </div>
      <div class="sphinxsidebar">
        <div class="sphinxsidebarwrapper">
<h1 class="logo"><a href="../../../../index.html">WEM</a></h1>





<p>
<iframe src="http://ghbtns.com/github-btn.html?user=&repo=&type=watch&count=true&size=large"
  allowtransparency="true" frameborder="0" scrolling="0" width="200px" height="35px"></iframe>
</p>


<h3>Navigation</h3>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../../WEM.html">WEM package</a></li>
</ul>


<div id="searchbox" style="display: none">
  <h3>Quick search</h3>
    <form class="search" action="../../../../search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    <p class="searchtip" style="font-size: 90%">
    Enter search terms or a module, class or function name.
    </p>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>
        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="footer">
      &copy;2014, John Lawson.
      
      |
      Powered by <a href="http://sphinx-doc.org/">Sphinx 1.2.2</a>
      &amp; <a href="https://github.com/bitprophet/alabaster">Alabaster 0.6.1</a>
      
    </div>

    

    
  </body>
</html>